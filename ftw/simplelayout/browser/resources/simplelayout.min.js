/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

(function(e){if(!e)throw new Error("JQuery is not defined.");if(!e.ui)throw new Error("JQuery-UI is not defined.");if(!e.templates)throw new Error("jsrender is not defined");var t,n,r;(function(e){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(t,n){return function(){var r=p.call(arguments,0);return typeof r[0]!="string"&&r.length===1&&r.push(null),s.apply(e,r.concat([t,n]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(t){if(v(f,t)){var n=f[t];delete f[t],c[t]=!0,i.apply(e,n)}if(!v(a,t)&&!v(c,t))throw new Error("No "+t);return a[t]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(t,n,r,i){var s,l,h,p,d,m=[],y=typeof r,E;i=i||t;if(y==="undefined"||y==="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(d=0;d<n.length;d+=1){p=o(n[d],i),l=p.f;if(l==="require")m[d]=u.require(t);else if(l==="exports")m[d]=u.exports(t),E=!0;else if(l==="module")s=m[d]=u.module(t);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=r?r.apply(a[t],m):undefined;if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!E)a[t]=h}else t&&(a[t]=r)},t=n=s=function(t,n,r,a,f){if(typeof t=="string")return u[t]?u[t](n):w(o(t,n).f);if(!t.splice){l=t,l.deps&&s(l.deps,l.callback);if(!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},typeof r=="function"&&(r=a,a=f),a?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),s},s.config=function(e){return s(e)},t._defined=a,r=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},r.amd={jQuery:!0}})(),r("../node_modules/almond/almond",function(){}),r("simplelayout/Block",[],function(){function t(n,r){if(this instanceof t){var i=e.templates("<div class='sl-block'><div class='sl-block-content'>{{:data}}</div></div>");return n||(n="auto"),{committed:!1,height:n,uid:null,getElement:function(){return this.element},create:function(){var t=this,n={data:r};return this.element=e(i.render(n)).height(this.height),this.element},content:function(t){e(".sl-block-content",this.element).html(t)},toJSON:function(){return{height:this.height,uid:this.uid}}}}throw new TypeError("Block constructor cannot be called as a function.")}return t}),r("simplelayout/Column",["simplelayout/Block"],function(t){function n(r){if(this instanceof n){var i=0,s=e.templates("<div class='sl-column sl-col-{{:column}}'></div>");return{blocks:{},getElement:function(){return this.element},create:function(){this.element=e(s.render({column:r}))},insertBlock:function(e,n){var r=i,s=new t(e,n);return s.create(),s.getElement().data("block-id",r),s.getElement().data("column-id",this.getElement().data("column-id")),s.getElement().data("layout-id",this.getElement().data("layout-id")),this.getElement().append(s.getElement()),this.blocks[r]=s,i++,r},deleteBlock:function(e){if(!this.blocks[e])throw new Error("No block with id "+e+" inserted.");this.blocks[e].getElement().remove(),delete this.blocks[e]},commitBlocks:function(){if(Object.keys(this.getCommittedBlocks()).length===Object.keys(this.getBlocks()).length)throw new Error("No blocks inserted.");for(var e in this.blocks)this.blocks[e].committed=!0},getCommittedBlocks:function(){var e={};for(var t in this.blocks)this.blocks[t].committed&&(e[t]=this.blocks[t]);return e},getBlocks:function(){return this.blocks},toJSON:function(){return{blocks:this.blocks}}}}throw new TypeError("Column constructor cannot be called as a function.")}return n}),r("simplelayout/Layout",["simplelayout/Column"],function(t){function n(r){if(this instanceof n){if(!r)throw new TypeError("columns must be defined");var i=e.templates("<div class='sl-layout'></div>");return{committed:!1,columns:{},getElement:function(){return this.element},create:function(n){this.element=e(i.render());for(var s=0;s<r;s++){var o=new t(r);this.columns[s]=o,o.create(),o.getElement().data("column-id",s),o.getElement().data("layout-id",n),this.element.append(o.getElement())}},getColumns:function(){return this.columns},insertBlock:function(e,t,n){var r=this.columns[e];return r.insertBlock(t,n)},deleteBlock:function(e,t){var n=this.columns[e];n.deleteBlock(t)},commitBlocks:function(e){this.getColumns()[e].commitBlocks()},toJSON:function(){return{columns:this.columns}}}}throw new TypeError("Layout constructor cannot be called as a function.")}return n}),r("simplelayout/Layoutmanager",["simplelayout/Layout"],function(t){function n(r){if(this instanceof n){var i=e.extend({width:"100%",blockHeight:"auto"},r||{}),s=e("<div>").addClass("sl-simplelayout").css("width",i.width),o=0;return{layouts:{},minImageWidth:null,options:i,element:s,attachTo:function(e){e.append(s)},getElement:function(){return this.element},insertLayout:function(e){var n=o,r=new t(e);return r.create(n),r.getElement().data("layout-id",n),s.append(r.getElement()),this.layouts[n]=r,o++,this.element.trigger("layoutInserted",[n]),n},deleteLayout:function(e){this.layouts[e].getElement().remove(),delete this.layouts[e],this.element.trigger("layoutDeleted")},commitLayouts:function(){for(var e in this.layouts)this.layouts[e].committed=!0;this.element.trigger("layoutsCommitted")},getCommittedLayouts:function(){var e={};for(var t in this.layouts)this.layouts[t].committed&&(e[t]=this.layouts[t]);return e},getLayouts:function(){return this.layouts},insertBlock:function(e,t,n,r){var i=n||this.options.blockHeight,s=this.layouts[e],o=s.insertBlock(t,i,r);return this.layouts[e].getColumns()[t].getBlocks()[o].getElement().find("img").width(this.minImageWidth),this.element.trigger("blockInserted",[e,t,o]),o},deleteBlock:function(e,t,n){var r=this.layouts[e];r.deleteBlock(t,n),this.element.trigger("blockDeleted")},commitBlocks:function(e,t){this.getLayouts()[e].commitBlocks(t),this.element.trigger("blocksCommitted",[e,t])},moveBlock:function(e,t,n,r,i){var s=this.getLayouts()[e],o=s.getColumns()[t],u=o.getBlocks()[n];u.getElement().data("layoutId",r),u.getElement().data("columnId",i),delete o.getBlocks()[n],this.getLayouts()[r].getColumns()[i].getBlocks()[n]=u,this.element.trigger("blockMoved",[e,t,n,r,i])},serialize:function(){var t=this,n={layouts:[],blocks:[]};return e(".sl-layout",this.element).each(function(r,i){e(".sl-column",i).each(function(i,s){e(".sl-block",s).each(function(s,o){o=e(o);var u=o.data("blockId"),a=o.data("columnId"),f=o.data("layoutId"),l=t.getLayouts()[f].getColumns()[a].getBlocks()[u],c={};c.height=l.height,c.layoutPos=r,c.columnPos=i,c.blockPos=s,n.blocks.push(c),n.layouts.push(Object.keys(t.getLayouts()[f].getColumns()).length)})})}),JSON.stringify(n)},deserialize:function(t){var n=this;t=JSON.parse(t),e.each(t.layouts,function(e,t){n.insertLayout(t)}),n.commitLayouts(),e.each(t.blocks,function(e,t){n.insertBlock(t.layoutPos,t.columnPos,t.height),n.commitBlocks(t.layoutPos,t.columnPos)}),this.element.trigger("deserialized")}}}throw new TypeError("Layoutmanager constructor cannot be called as a function.")}return n}),r("simplelayout/Eventrecorder",[],function(){function t(){if(this instanceof t)return{eventId:0,eventQueue:{},record:function(t){e(t.target).data("event-id",this.eventId),this.eventQueue[this.eventId]=t,this.eventId++},lookup:function(t){var n=this.eventQueue[e(t.target).data("event-id")];if(!n)throw new Error("No event for lookup.");return n},getEventQueue:function(){return this.eventQueue},flush:function(){this.eventQueue={},this.eventId=0}};throw new TypeError("Eventrecorder constructor cannot be called as a function.")}return t}),r("simplelayout/Simplelayout",["simplelayout/Layoutmanager","simplelayout/Eventrecorder"],function(t,n){function r(i){if(this instanceof r){var s=e.extend({imageCount:1},i||{}),o=new n,u=new t(i),a,f={handles:"s",resize:function(e,t){var n=t.element.data("layout-id"),r=t.element.data("column-id"),i=t.element.data("blockId");u.getLayouts()[n].getColumns()[r].getBlocks()[i].height=parseInt(t.size.height)},create:function(t,n){e(t.target).find(".ui-resizable-s").addClass("icon-resize")}},l={helper:"clone",cursor:"pointer",start:function(t,n){e(t.target).hasClass("sl-toolbox-component")&&Object.keys(u.getLayouts()).length===0&&(columns=a.options.layouts[0],layoutId=u.insertLayout(columns),u.commitLayouts())}},c={accept:".sl-layout, .sl-block",tolerance:"touch",over:function(e,t){var n;if(t.draggable.hasClass("sl-layout")){n=t.draggable.data("layout-id");var r=u.getLayouts()[n],i=!1;for(var s in r.getColumns())if(Object.keys(r.getColumns()[s].getBlocks()).length>0){i=!0;break}r.getElement().addClass("deleted"),i&&r.getElement().addClass("cancelDeletion")}else{n=t.draggable.data("layout-id");var o=t.draggable.data("column-id"),a=t.draggable.data("block-id"),f=u.getLayouts()[n].getColumns()[o].getBlocks()[a];f.getElement().addClass("deleted")}},drop:function(e,t){var n;if(t.draggable.hasClass("sl-layout")){n=t.draggable.data("layout-id");var r=u.getLayouts()[n];r.getElement().hasClass("cancelDeletion")||u.deleteLayout(n),r.getElement().removeClass("deleted cancelDeletion")}else{n=t.draggable.data("layout-id");var i=t.draggable.data("column-id"),s=t.draggable.data("block-id"),o=u.getLayouts()[n].getColumns()[i].getBlocks()[s];u.deleteBlock(n,i,s)}},out:function(e,t){if(t.draggable.hasClass("sl-layout")){var n=t.draggable.data("layout-id"),r=u.getLayouts()[n];r.getElement().removeClass("deleted cancelDeletion")}else{var n=t.draggable.data("layout-id"),i=t.draggable.data("column-id"),s=t.draggable.data("block-id"),o=u.getLayouts()[n].getColumns()[i].getBlocks()[s];o.getElement().removeClass("deleted")}}},h={connectWith:".sl-simplelayout",items:".sl-layout",placeholder:"placeholder",forcePlaceholderSize:!0},p={connectWith:".sl-column",placeholder:"placeholder",forcePlaceholderSize:!0,receive:function(t,n){if(n&&n.item){var r=e(t.target),i=n.item.data("column-id"),s=n.item.data("layout-id"),o=n.item.data("block-id"),a=n.item.data("type"),f=n.item.html(),l=r.data("column-id"),c=r.data("layout-id");u.moveBlock(s,i,o,c,l,a,f)}}},d={accept:".sl-toolbox-component",over:function(t,n){try{var r=e(this).parent().data("layout-id"),i=e(this).data("column-id"),s=u.insertBlock(r,i,null,null);t.data={blockId:s,columnId:i,layoutId:r},o.record(t)}catch(a){}},out:function(e){try{var t=o.lookup(e).data;u.deleteBlock(t.layoutId,t.columnId,t.blockId)}catch(n){}},drop:function(e){try{var t=o.lookup(e).data;u.commitBlocks(t.layoutId,t.columnId),u.getLayouts()[t.layoutId].getElement().find(".sl-column").sortable("refresh"),o.flush()}catch(n){}}},v={accept:".sl-toolbox-layout",over:function(e,t){try{var n=t.draggable.data("columns"),r=u.insertLayout(n);e.data={layoutId:r},o.record(e)}catch(i){}},out:function(e){try{u.deleteLayout(o.lookup(e).data.layoutId)}catch(t){}},drop:function(e){try{var t=o.lookup(e).data;u.commitLayouts(),u.getLayouts()[t.layoutId].getElement().find(".sl-layout").sortable("refresh"),o.flush()}catch(n){}}},m={cursor:"pointer",containment:"window",handle:".sl-toolbox-handle"},g=function(){u.getElement().droppable(v),u.getElement().sortable(h)},y=function(){a.getElement().find(".sl-toolbox-component, .sl-toolbox-layout").draggable(l),a.getElement().find(".sl-toolbox-trash").droppable(c),u.getElement().on("blockInserted",function(e,t,n,r){u.getLayouts()[t].getColumns()[n].getBlocks()[r].getElement().resizable(f)}),u.getElement().on("layoutInserted",function(e,t){u.getLayouts()[t].getElement().find(".sl-column").droppable(d).sortable(p)}),a.getElement().draggable(m)};return g(),{options:s,getLayoutmanager:function(){return u},getEventrecorder:function(){return o},getToolbox:function(){return a},attachTo:function(e){u.attachTo(e)},attachToolbox:function(e){if(!e)throw new Error("No toolbox defined");if(u.getElement().parent().length===0)throw new Error("Not attached to DOM element");a=e,u.minImageWidth=u.getElement().width()/Math.max.apply(null,a.options.layouts)/this.options.imageCount,y()}}}throw new TypeError("Simplelayout constructor cannot be called as a function.")}return r}),r("toolbox/Toolbox",[],function(){function t(n){if(this instanceof t){if(!n||!n.layouts||n.layouts.length===0)throw new Error("No layouts defined.");[{title:"Listingblock",description:"can list things",contentType:"listingblock",formURL:"http://www.google.com"},{title:"Textblock",description:"can show text","content-type":"textblock",formURL:"http://www.bing.com"}];var r=e.extend(n||{}),i=[];e.each(r.layouts,function(e,t){i.push({columns:t})});var s=100/Math.max.apply(null,r.layouts)/r.imageCount,o=e.templates("<div id='sl-toolbox' class='sl-toolbox'>           <div class='components'>             <a class='sl-toolbox-header sl-toolbox-handle'>Toolbox</a>             <a class='sl-toolbox-header'>Komponenten</a>               {{for components}}                 <a class='sl-toolbox-component' title='{{:description}}' data-form_url='{{:form_url}}'>                   <i class='{{:content_type}}'></i>{{:title}}                 </a>               {{/for}}             <a class='sl-toolbox-header'>Layout</a>               {{for layouts}}                 <a class='sl-toolbox-layout' data-columns='{{:columns}}'>                   <i class='icon-layout'></i>{{:columns}} - Spalten Layout                 </a>                {{/for}}           </div>           <div class='sl-toolbox-trash'>             <i class='icon-trash'></i>           </div>         </div>"),u={components:r.components,layouts:i},a=e(o.render(u));return{options:r,attachTo:function(e){e.append(a)},getMinImageWidth:function(){return s},getElement:function(){return a}}}throw new TypeError("Toolbox constructor cannot be called as a function.")}return t});var i=n("simplelayout/Simplelayout"),s=n("toolbox/Toolbox");window.Simplelayout=i,window.Toolbox=s})($);