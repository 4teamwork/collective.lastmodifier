/**
 * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*! JsRender v1.0.0-beta: http://github.com/BorisMoore/jsrender and http://jsviews.com/jsviews
informal pre V1.0 commit counter: 62 */

/*
 * Optimized version of jQuery Templates, for rendering to string.
 * Does not require jQuery, or HTML DOM
 * Integrates with JsViews (http://jsviews.com/jsviews)
 *
 * Copyright 2015, Boris Moore
 * Released under the MIT License.
 */

(function(e){if(!e)throw new Error("JQuery is not defined.");if(!e.ui)throw new Error("JQuery-UI is not defined.");var t,n,r;(function(e){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(t,n){return function(){var r=p.call(arguments,0);return typeof r[0]!="string"&&r.length===1&&r.push(null),s.apply(e,r.concat([t,n]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(t){if(v(f,t)){var n=f[t];delete f[t],c[t]=!0,i.apply(e,n)}if(!v(a,t)&&!v(c,t))throw new Error("No "+t);return a[t]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(t,n,r,i){var s,l,h,p,d,m=[],y=typeof r,E;i=i||t;if(y==="undefined"||y==="function"){n=!n.length&&r.length?["require","exports","module"]:n;for(d=0;d<n.length;d+=1){p=o(n[d],i),l=p.f;if(l==="require")m[d]=u.require(t);else if(l==="exports")m[d]=u.exports(t),E=!0;else if(l==="module")s=m[d]=u.module(t);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(t+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=r?r.apply(a[t],m):undefined;if(t)if(s&&s.exports!==e&&s.exports!==a[t])a[t]=s.exports;else if(h!==e||!E)a[t]=h}else t&&(a[t]=r)},t=n=s=function(t,n,r,a,f){if(typeof t=="string")return u[t]?u[t](n):w(o(t,n).f);if(!t.splice){l=t,l.deps&&s(l.deps,l.callback);if(!n)return;n.splice?(t=n,n=r,r=null):t=e}return n=n||function(){},typeof r=="function"&&(r=a,a=f),a?i(e,t,n,r):setTimeout(function(){i(e,t,n,r)},4),s},s.config=function(e){return s(e)},t._defined=a,r=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},r.amd={jQuery:!0}})(),r("../node_modules/almond/almond",function(){}),r("simplelayout/Block",[],function(){function t(n,r){if(this instanceof t){var i=e.templates('<div data-type="{{:type}}" class="sl-block"><div class="sl-block-content">{{:content}}</div></div>');return{committed:!1,uid:null,toolbar:null,type:r,element:null,create:function(){var t={content:n,type:r};return this.element=e(i.render(t)),this.element},content:function(t){e(".sl-block-content",this.element).html(t)},commit:function(){this.committed=!0},attachToolbar:function(e){this.toolbar=e,this.element.append(e.element)},toJSON:function(){return{uid:this.uid,type:r}}}}throw new TypeError("Block constructor cannot be called as a function.")}return t}),r("simplelayout/Column",["simplelayout/Block"],function(t){function n(r){if(this instanceof n){if(!r)throw new Error("Columns are not defined.");var i=e.templates("<div class='sl-column sl-col-{{:column}}''></div>");return{blocks:{},element:null,create:function(){return this.element=e(i.render({column:r})),this.element},insertBlock:function(e,n){var r=Object.keys(this.blocks).length,i=new t(e,n),s=i.create();return s.data("blockId",r),s.data("columnId",this.element.data("columnId")),s.data("layoutId",this.element.data("layoutId")),this.blocks[r]=i,r},deleteBlock:function(e){if(!this.blocks[e])throw new Error("No block with id "+e+" inserted.");this.blocks[e].element.remove(),delete this.blocks[e]},commitBlocks:function(){if(Object.keys(this.getCommittedBlocks()).length===Object.keys(this.blocks).length)throw new Error("No blocks inserted.");for(var e in this.blocks)this.blocks[e].commit()},hasBlocks:function(){return Object.keys(this.blocks).length>0},getCommittedBlocks:function(){var e=[];for(var t in this.blocks)this.blocks[t].committed&&e.push(this.blocks[t]);return e},getInsertedBlocks:function(){var e=[];for(var t in this.blocks)this.blocks[t].committed||e.push(this.blocks[t]);return e},toJSON:function(){return{blocks:this.blocks}}}}throw new TypeError("Column constructor cannot be called as a function.")}return n}),r("simplelayout/Layout",["simplelayout/Column"],function(t){function n(r){if(this instanceof n){if(!r)throw new TypeError("Columns are not defined.");var i=e.templates("<div class='sl-layout'></div>");return{committed:!1,columns:{},toolbar:null,create:function(n){this.element=e(i.render()),this.element.data("layoutId",n);for(var s=0;s<r;s++){var o=new t(r);this.columns[s]=o;var u=o.create();u.data("column-id",s),u.data("layout-id",n),this.element.append(u)}return this.element},commit:function(){this.committed=!0},insertBlock:function(e,t,n){var r=this.columns[e];return r.insertBlock(t,n)},deleteBlock:function(e,t){var n=this.columns[e];n.deleteBlock(t)},commitBlocks:function(e){this.columns[e].commitBlocks()},attachToolbar:function(e){this.toolbar=e,this.element.append(e.element)},getCommittedBlocks:function(){var t=[];for(var n in this.columns)t=e.merge(this.columns[n].getCommittedBlocks(),t);return t},getInsertedBlocks:function(){var t=[];for(var n in this.columns)t=e.merge(this.columns[n].getInsertedBlocks(),t);return t},hasBlocks:function(){var t=!1;return e.each(this.columns,function(e,n){if(n.hasBlocks())return t=!0,!1}),t},toJSON:function(){return{columns:this.columns}}}}throw new TypeError("Layout constructor cannot be called as a function.")}return n}),r("simplelayout/Layoutmanager",["simplelayout/Layout"],function(t){function r(i){if(this instanceof r){var s=e.extend({width:"100%"},i||{}),o;if(s.source)o=e(s.source),o.addClass("sl-simplelayout");else{var u=e.templates("<div class='sl-simplelayout' style='width:{{:width}};''></div>");o=e(u.render(s))}return{layouts:{},id:0,options:s,element:o,attachTo:function(t){e(t).append(o)},insertLayout:function(e){var n=this.id,r=new t(e);return r.create(n),this.layouts[n]=r,this.id++,this.element.trigger("layoutInserted",[n]),n},deleteLayout:function(e){this.layouts[e].element.remove(),delete this.layouts[e],this.element.trigger("layoutDeleted")},commitLayouts:function(){for(var e in this.layouts)this.layouts[e].commit();this.element.trigger("layoutsCommitted")},getCommittedLayouts:function(){var e={};for(var t in this.layouts)this.layouts[t].committed&&(e[t]=this.layouts[t]);return e},getBlock:function(e,t,n){return this.layouts[e].columns[t].blocks[n]},getCommittedBlocks:function(){var t=[];for(var n in this.layouts)t=e.merge(this.layouts[n].getCommittedBlocks(),t);return t},getInsertedBlocks:function(){var t=[];for(var n in this.layouts)t=e.merge(this.layouts[n].getInsertedBlocks(),t);return t},setBlock:function(e,t,n,r){this.layouts[e].columns[t].blocks[n]=r},insertBlock:function(e,t,n,r){var i=this.layouts[e],s=i.insertBlock(t,n,r);return this.getBlock(e,t,s),this.element.trigger("blockInserted",[e,t,s]),s},deleteBlock:function(e,t,n){var r=this.layouts[e];r.deleteBlock(t,n),this.element.trigger("blockDeleted",[e,t,n])},commitBlocks:function(e,t){this.layouts[e].commitBlocks(t),this.element.trigger("blocksCommitted",[e,t])},moveLayout:function(e){this.element.trigger("layoutMoved",[e])},hasLayouts:function(){return Object.keys(this.layouts)>0},moveBlock:function(e,t,n,r,i){var s=this.layouts[e],o=s.columns[t],u=o.blocks[n],a=Object.keys(this.layouts[r].columns[i].blocks).length;u.element.data("layoutId",r),u.element.data("columnId",i),u.element.data("blockId",a),delete o.blocks[n],this.layouts[r].columns[i].blocks[a]=u,this.element.trigger("blockMoved",[e,t,n,r,i,a])},serialize:function(){var t=this,n={layouts:[],blocks:[]};return e(".sl-layout",this.element).each(function(r,i){n.layouts.push(Object.keys(t.layouts[e(i).data("layoutId")].columns).length),e(".sl-column",i).each(function(t,i){e(".sl-block",i).each(function(i,s){s=e(s);var o=s.data("uid"),u={};u.layoutPos=r,u.columnPos=t,u.blockPos=i,u.uid=o,n.blocks.push(u)})})}),JSON.stringify(n)},deserialize:function(){var r=n("simplelayout/Column"),i=n("simplelayout/Block"),s=n("simplelayout/Toolbar"),u,a=this;e(".sl-layout",o).each(function(n,o){var f=e(o);a.layouts[n]=new t(f.children(".sl-column").length),a.layouts[n].element=f,a.layouts[n].element.data("layoutId",n);var l=new s(a.toolbox.options.layoutActions,"vertical","layout");a.layouts[n].attachToolbar(l),a.id++,e(".sl-column",o).each(function(t,o){var l=e(o);a.layouts[n].columns[t]=new r(f.children(".sl-column").length),a.layouts[n].columns[t].element=l,a.layouts[n].columns[t].element.data("layoutId",n),a.layouts[n].columns[t].element.data("columnId",t),e(".sl-block",o).each(function(r,o){var f=e(o);a.setBlock(n,t,r,new i),a.getBlock(n,t,r).element=f,a.getBlock(n,t,r).type=f.data("type"),u=new s(a.toolbox.options.components[f.data("type")].actions,"horizontal","block"),a.getBlock(n,t,r).attachToolbar(u),a.getBlock(n,t,r).element.data("layoutId",n),a.getBlock(n,t,r).element.data("columnId",t),a.getBlock(n,t,r).element.data("blockId",r)})})})}}}throw new TypeError("Layoutmanager constructor cannot be called as a function.")}return r}),r("simplelayout/Eventrecorder",[],function(){function t(){if(this instanceof t)return{eventId:0,eventQueue:{},record:function(t){e(t.target).data("event-id",this.eventId),this.eventQueue[this.eventId]=t,this.eventId++},lookup:function(t){var n=this.eventQueue[e(t.target).data("event-id")];if(!n)throw new Error("No event for lookup.");return n},getEventQueue:function(){return this.eventQueue},flush:function(){this.eventQueue={},this.eventId=0}};throw new TypeError("Eventrecorder constructor cannot be called as a function.")}return t}),r("simplelayout/Toolbar",[],function(){function t(n,r,i){if(this instanceof t){var s={},o=e.extend(s,n||{}),u=[];e.each(o,function(e,t){u.push(t)});var a=e.templates("<ul class='sl-toolbar{{if type}}-{{:type}}{{/if}}{{if orientation}} {{:orientation}}{{/if}}'>{{for actions}}<li><a {{props}} {{>key}}='{{>prop}}' {{/props}}></a></li><li class='delimiter'></li>{{/for}}</ul>"),f=e(a.render({actions:u,orientation:r,type:i}));return{element:f}}throw new TypeError("Toolbar constructor cannot be called as a function.")}return t}),r("simplelayout/Simplelayout",["simplelayout/Layoutmanager","simplelayout/Eventrecorder","simplelayout/Toolbar"],function(t,n,r){function i(s){if(this instanceof i){var o=s||{},u=new n,a=new t(s),f=null,l=null,c=null,h={helper:"clone",cursor:"pointer"},p={connectWith:".sl-simplelayout",items:".sl-layout",handle:".sl-toolbar-layout .move",placeholder:"layout-placeholder",layoutId:null,axis:"y",forcePlaceholderSize:!0,receive:function(t,n){var i=e(this).find(".ui-draggable");this.layoutId=a.insertLayout(n.item.data("columns"));var s=new r(f.options.layoutActions,"vertical","layout");a.layouts[this.layoutId].attachToolbar(s),a.layouts[this.layoutId].element.insertAfter(i),i.remove(),a.commitLayouts()},update:function(e,t){a.moveLayout(t.item.data("layoutId"))}},d={connectWith:".sl-column",placeholder:"block-placeholder",layoutId:null,columnId:null,blockId:null,forcePlaceholderSize:!0,handle:".sl-toolbar-block .move",tolerance:"pointer",receive:function(t,n){var i=e(this).find(".ui-draggable");this.layoutId=e(this).data("layoutId"),this.columnId=e(this).data("columnId");var s=n.item.data("type");this.blockId=a.insertBlock(this.layoutId,this.columnId,null,s);var o=new r(f.options.components[s].actions,"horizontal","block");a.getBlock(this.layoutId,this.columnId,this.blockId).attachToolbar(o),a.getBlock(this.layoutId,this.columnId,this.blockId).element.insertAfter(i),i.remove(),a.commitBlocks(this.layoutId,this.columnId)},update:function(t,n){var r=e(t.target),i=n.item.data("column-id"),s=n.item.data("layout-id"),o=n.item.data("block-id"),u=n.item.data("type"),f=n.item.html(),l=r.data("column-id"),c=r.data("layout-id");a.moveBlock(s,i,o,c,l,u,f)}},v=function(e,t){a.element.on(e,function(){t.apply(this,arguments)})},m=function(){f.element.find(".sl-toolbox-component, .sl-toolbox-layout").draggable(h),f.element.find(".sl-toolbox-layout").draggable("option","connectToSortable",".sl-simplelayout"),f.element.find(".sl-toolbox-component").draggable("option","connectToSortable",".sl-column")},g=function(){var t,n,r,i;a.element.sortable(p),e(".sl-column").sortable(d),v("layoutsCommitted",function(){e(".sl-column").sortable(d)}),a.element.on("mouseover",".sl-block",function(){i=e(this).data(),t=i.layoutId,n=i.columnId,r=i.blockId,l=a.getBlock(t,n,r)}),a.element.on("mouseover",".sl-layout",function(){i=e(this).data(),t=i.layoutId,c=a.layouts[t]})};return g(),{options:o,getActiveBlock:function(){return l},getActiveLayout:function(){return c},getLayoutmanager:function(){return a},getEventrecorder:function(){return u},getToolbox:function(){return f},attachTo:function(e){a.attachTo(e)},attachToolbox:function(e){if(!e)throw new Error("No toolbox defined");if(a.element.parent().length===0)throw new Error("Not attached to DOM element");f=e,a.toolbox=f,m()},on:v,bindEvents:function(){g(),m()}}}throw new TypeError("Simplelayout constructor cannot be called as a function.")}return i}),r("toolbox/Toolbox",[],function(){function t(n){if(this instanceof t){if(!n||!n.layouts||n.layouts.length===0)throw new Error("No layouts defined.");var r=e.extend({components:{}},n||{});r.layoutActions={move:{"class":"icon-move move",title:"Move this layout arround."},"delete":{"class":"icon-delete delete",title:"Delete this layout."}};var i=[];e.each(r.layouts,function(e,t){i.push({columns:t})});var s=e.templates("<div id='sl-toolbox' class='sl-toolbox'>           <div class='components'>             <div class='addables'>               <a class='sl-toolbox-header'>Komponenten</a>                 <div class='sl-toolbox-components'>                   {{for components}}                     <a class='sl-toolbox-component' title='{{:description}}' data-type='{{:contentType}}' data-form_url='{{:formUrl}}'>                       <i class='icon-{{:contentType}}'></i>{{:title}}                     </a>                   {{/for}}                 </div>               <a class='sl-toolbox-header'>Layout</a>                 {{for layouts}}                   <a class='sl-toolbox-layout' data-columns='{{:columns}}'>                     <i class='icon-layout'></i>{{:columns}} - Spalten Layout                   </a>                  {{/for}}             </div>             <a class='sl-toolbox-header sl-toolbox-handle'>Toolbox</a>           </div>         </div>"),o=[];e.each(r.components,function(e,t){o.push(t)});var u={components:o,layouts:i},a=e(s.render(u));return e(".sl-toolbox-component",a).each(function(t,n){e(n).data("actions",r.components[e(n).data("type")].actions)}),e(".sl-toolbox-handle",a).on("click",function(){e(".addables").toggleClass("close")}),{options:r,element:a,disableComponents:function(){e(".sl-toolbox-components",this.element).addClass("disabled")},enableComponents:function(){e(".sl-toolbox-components",this.element).removeClass("disabled")},attachTo:function(e){e.append(a)}}}throw new TypeError("Toolbox constructor cannot be called as a function.")}return t}),function(e){r("matchHeight",[],function(){return function(){return function(e){var t=-1,n=-1,r=function(t){var n=1,r=e(t),s=null,o=[];return r.each(function(){var t=e(this),r=t.offset().top-i(t.css("margin-top")),u=o.length>0?o[o.length-1]:null;u===null?o.push(t):Math.floor(Math.abs(s-r))<=n?o[o.length-1]=u.add(t):o.push(t),s=r}),o},i=function(e){return parseFloat(e)||0},s=function(t){var n={byRow:!0,remove:!1,property:"height"};return typeof t=="object"?e.extend(n,t):(typeof t=="boolean"?n.byRow=t:t==="remove"&&(n.remove=!0),n)},o=e.fn.matchHeight=function(t){var n=s(t);if(n.remove){var r=this;return this.css(n.property,""),e.each(o._groups,function(e,t){t.elements=t.elements.not(r)}),this}return this.length<=1?this:(o._groups.push({elements:this,options:n}),o._apply(this,n),this)};o._groups=[],o._throttle=80,o._maintainScroll=!1,o._beforeUpdate=null,o._afterUpdate=null,o._apply=function(t,n){var u=s(n),a=e(t),f=[a],l=e(window).scrollTop(),c=e("html").outerHeight(!0),h=a.parents().filter(":hidden");return h.each(function(){var t=e(this);t.data("style-cache",t.attr("style"))}),h.css("display","block"),u.byRow&&(a.each(function(){var t=e(this),n=t.css("display")==="inline-block"?"inline-block":"block";t.data("style-cache",t.attr("style")),t.css({display:n,"padding-top":"0","padding-bottom":"0","margin-top":"0","margin-bottom":"0","border-top-width":"0","border-bottom-width":"0",height:"100px"})}),f=r(a),a.each(function(){var t=e(this);t.attr("style",t.data("style-cache")||"")})),e.each(f,function(t,n){var r=e(n),s=0;if(u.byRow&&r.length<=1){r.css(u.property,"");return}r.each(function(){var t=e(this),n=t.css("display")==="inline-block"?"inline-block":"block",r={display:n};r[u.property]="",t.css(r),t.outerHeight(!1)>s&&(s=t.outerHeight(!1)),t.css("display","")}),r.each(function(){var t=e(this),n=0;t.css("box-sizing")!=="border-box"&&(n+=i(t.css("border-top-width"))+i(t.css("border-bottom-width")),n+=i(t.css("padding-top"))+i(t.css("padding-bottom"))),t.css(u.property,s-n)})}),h.each(function(){var t=e(this);t.attr("style",t.data("style-cache")||null)}),o._maintainScroll&&e(window).scrollTop(l/c*e("html").outerHeight(!0)),this},o._applyDataApi=function(){var t={};e("[data-match-height], [data-mh]").each(function(){var n=e(this),r=n.attr("data-match-height")||n.attr("data-mh");r in t?t[r]=t[r].add(n):t[r]=n}),e.each(t,function(){this.matchHeight(!0)})};var u=function(t){o._beforeUpdate&&o._beforeUpdate(t,o._groups),e.each(o._groups,function(){o._apply(this.elements,this.options)}),o._afterUpdate&&o._afterUpdate(t,o._groups)};o._update=function(r,i){if(i&&i.type==="resize"){var s=e(window).width();if(s===t)return;t=s}r?n===-1&&(n=setTimeout(function(){u(i),n=-1},o._throttle)):u(i)},e(o._applyDataApi),e(window).bind("load",function(e){o._update(!1,e)}),e(window).bind("resize orientationchange",function(e){o._update(!0,e)})}(jQuery),jQuery.fn.matchHeight}.apply(e,arguments)})}(this),function(e){r("jsrender",[],function(){return function(){return function(e,t,n){function H(e){return this.base.apply(this,e)}function B(e,t){return function(){var n,r=this,i=r.base;return r.base=e,n=t.apply(r,arguments),r.base=i,n}}function j(e,t){return X(t)&&(t=B(e?e._d?e:B(q,e):q,t),t._d=1),t}function F(e,t){for(var n in t.props)T.test(n)&&(e[n]=j(e[n],t.props[n]))}function I(e){return e}function q(){return""}function R(e){debugger;return this.base?this.baseApply(arguments):e}function U(e){kt._dbgMode=e,a=e?"Unavailable (nested view): use #getIndex()":"",Nt("dbg",Tt.dbg=xt.dbg=e?R:I)}function z(e){this.name=(i.link?"JsViews":"JsRender")+" Error",this.message=e||this.name}function W(e,t){var n;for(n in t)e[n]=t[n];return e}function X(e){return typeof e=="function"}function V(e,t,n){if(!Ct.rTag||e)f=e?e.charAt(0):f,l=e?e.charAt(1):l,c=t?t.charAt(0):c,h=t?t.charAt(1):h,p=n||p,e="\\"+f+"(\\"+p+")?\\"+l,t="\\"+c+"\\"+h,o="(?:(?:(\\w+(?=[\\/\\s\\"+c+"]))|(?:(\\w+)?(:)|(>)|!--((?:[^-]|-(?!-))*)--|(\\*)))"+"\\s*((?:[^\\"+c+"]|\\"+c+"(?!\\"+h+"))*?)",Ct.rTag=o+")",o=new RegExp(e+o+"(\\/)?|(?:\\/(\\w+)))"+t,"g"),u=new RegExp("<.*>|([^\\\\]|^)[{}]|"+e+".*"+t);return[f,l,c,h,p]}function $(e,t){t||(t=e,e=n);var r,i,s,o,u=this,a=!t||t==="root";if(e){o=u.type===t?u:n;if(!o){r=u.views;if(u._.useKey){for(i in r)if(o=r[i].get(e,t))break}else for(i=0,s=r.length;!o&&i<s;i++)o=r[i].get(e,t)}}else if(a)while(u.parent.parent)o=u=u.parent;else while(u&&!o)o=u.type===t?u:n,u=u.parent;return o}function J(){var e=this.get("item");return e?e.index:n}function K(){return this.index}function Q(t){var r,i=this,s=i.linkCtx,o=(i.ctx||{})[t];return o===n&&s&&s.ctx&&(o=s.ctx[t]),o===n&&(o=Tt[t]),o&&X(o)&&!o._wrp&&(r=function(){return o.apply(!this||this===e?i:this,arguments)},r._wrp=!0,W(r,o)),r||o}function G(e,t,r,i){var s,o,u=+r===r&&t.tmpl.bnds[r-1],a=t.linkCtx;i=i!==n&&{props:{},args:[i]},r=i||(u?u(t.data,t,P):r),o=r.args[0];if(e||u)s=a&&a.tag,s||(s={_:{inline:!a,bnd:u,unlinked:!0},tagName:":",cvt:e,flow:!0,tagCtx:r,baseApply:H,_is:"tag"},a&&(a.tag=s,s.linkCtx=a),r.ctx=wt(r.ctx,(a?a.view:t).ctx),Ct._lnk(s)),s._er=i&&o,F(s,r),r.view=t,s.ctx=r.ctx||{},delete r.ctx,t._.tag=s,o=Y(s,s.convert||e!=="true"&&e)[0],o=u&&t._.onRender?t._.onRender(o,t,u):o,t._.tag=n;return o!=n?o:""}function Y(e,t){var n=e.tagCtx,r=n.view,i=n.args;return t=t&&(""+t===t?r.getRsc("converters",t)||ht("Unknown converter: '"+t+"'"):t),i=!i.length&&!n.index?[r.data]:t?i.slice():i,t&&(t.depends&&(e.depends=Ct.getDeps(e.depends,e,t.depends,t)),i[0]=t.apply(e,i)),i}function Z(e,t){var r,i,s=this;while(r===n&&s)i=s.tmpl[e],r=i&&i[t],s=s.parent;return r||P[e][t]}function et(e,t,r,i,s,o){var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T="",N=t.linkCtx||0,C=t.ctx,k=r||t.tmpl,L=+i===i&&k.bnds[i-1];e._is==="tag"&&(u=e,e=u.tagName,i=u.tagCtxs),u=u||N.tag,o=o!==n&&(T+=o,[{props:{},args:[]}]),i=o||(L?L(t.data,t,P):i),h=i.length;for(c=0;c<h;c++){!c&&(!r||!u)&&(g=t.getRsc("tags",e)||ht("Unknown tag: {{"+e+"}}")),d=i[c];if(!N.tag||c&&!N.tag._.inline||u._er)m=d.tmpl,m=d.content=m&&k.tmpls[m-1],W(d,{tmpl:(u?u:g).template||m,render:ct,index:c,view:t,ctx:wt(d.ctx,C)});if(r=d.props.tmpl)r=""+r===r?t.getRsc("templates",r)||St(r):r,d.tmpl=r;u||(g._ctr?(u=new g._ctr,y=!!u.init):Ct._lnk(u={render:g.render}),u._={inline:!N,unlinked:!0},N&&(N.tag=u,u.linkCtx=N),(u._.bnd=L||N.fn)?u._.arrVws={}:u.dataBoundOnly&&ht("{^{"+e+"}} tag must be data-bound"),u.tagName=e,u.parent=l=C&&C.tag,u._is="tag",u._def=g,u.tagCtxs=i),d.tag=u,u.dataMap&&u.tagCtxs&&(d.map=u.tagCtxs[c].map),u.flow||(v=d.ctx=d.ctx||{},a=u.parents=v.parentTags=C&&wt(v.parentTags,C.parentTags)||{},l&&(a[l.tagName]=l),a[u.tagName]=v.tag=u)}t._.tag=u;if(!(u._er=o)){F(u,i[0]),u.rendering={};for(c=0;c<h;c++){d=u.tagCtx=u.tagCtxs[c],S=d.props,E=Y(u,u.convert);if(b=S.dataMap||u.dataMap)if(E.length||S.dataMap){w=d.map;if(!w||w.src!==E[0]||s)w&&w.src&&w.unmap(),w=d.map=b.map(E[0],S);E=[w.tgt]}u.ctx=d.ctx,!c&&y&&(x=u.template,u.init(d,N,u.ctx),y=n,u.template!==x&&(u._.tmpl=u.template)),N&&(N.attr=u.attr=N.attr||u.attr),p=n,u.render&&(p=u.render.apply(u,E)),E=E.length?E:[t],p=p!==n?p:d.render(E[0],!0)||(s?n:""),T=T?T+(p||""):p}delete u.rendering}return u.tagCtx=u.tagCtxs[0],u.ctx=u.tagCtx.ctx,u._.inline&&(f=u.attr)&&f!==A&&(T=f==="text"?xt.html(T):""),L&&t._.onRender?t._.onRender(T,t,L):T}function tt(e,t,n,r,i,s,o,u){var f,l,c,h=this,p=t==="array",d={key:0,useKey:p?0:1,id:""+k++,onRender:u,bnds:{}};h.data=r,h.tmpl=i,h.content=o,h.views=p?[]:{},h.parent=n,h.type=t||"top",h._=d,h.linked=!!u,n?(f=n.views,l=n._,l.useKey?(f[d.key="_"+l.useKey++]=h,h.index=a,h.getIndex=J,c=l.tag,d.bnd=p&&(!c||!!c._.bnd&&c)):f.splice(d.key=h.index=s,0,h),h.ctx=e||n.ctx):h.ctx=e}function nt(e){var t,n,r,i,s,o,u;for(t in D){s=D[t];if((o=s.compile)&&(n=e[t+"s"]))for(r in n)i=n[r]=o(r,n[r],e),i&&(u=Ct.onStore[t])&&u(r,i,o)}}function rt(e,t,r){var s,o,u,a,f,l={};X(t)&&(t={depends:t.depends,render:t});if(u=t.baseTag){t.flow=!!t.flow,t.baseTag=u=""+u===u?r&&r.tags[u]||i.views.tags[u]:u,l=W({},u);for(a in t)l[a]=j(u[a],t[a])}else l=W({},t);return l.baseApply=H,(o=l.template)!==n&&(l.template=""+o===o?St[o]||St(o):o),l.init!==!1&&(s=l._ctr=function(){},(s.prototype=l).constructor=s),r&&(l._parentTmpl=r),l}function it(r,i,s,o){function a(i){if(""+i===i||i.nodeType>0){try{l=i.nodeType>0?i:!u.test(i)&&t&&t(e.document).find(i)[0]}catch(a){}return l&&(i=St[r=r||l.getAttribute(M)],i||(r=r||"_"+C++,l.setAttribute(M,r),i=St[r]=it(r,l.innerHTML,s,o)),l=n),i}}var f,l;i=i||"",f=a(i),o=o||(i.markup?i:{}),o.tmplName=r,s&&(o._parentTmpl=s),!f&&i.markup&&(f=a(i.markup))&&f.fn&&(f.debug!==i.debug||f.allowCode!==i.allowCode)&&(f=f.markup);if(f!==n)return r&&!s&&(_[r]=function(){return i.render.apply(i,arguments)}),f.fn||i.fn?f.fn&&(r&&r!==f.tmplName?i=wt(o,f):i=f):(i=ot(f,o),dt(f.replace(y,"\\$&"),i)),nt(o),i}function st(e){function t(t,n){this.tgt=e.getTgt(t,n)}return X(e)&&(e={getTgt:e}),e.baseMap&&(e=W(W({},e.baseMap),e)),e.map=function(e,n){return new t(e,n)},e}function ot(e,t){var n,r=kt.wrapMap||{},s=W({markup:e,tmpls:[],links:{},tags:{},bnds:[],_is:"template",render:lt},t);return t.htmlTag||(n=E.exec(e),s.htmlTag=n?n[1].toLowerCase():""),n=r[s.htmlTag],n&&n!==r.div&&(s.markup=i.trim(s.markup)),s}function ut(e,t){function r(s,o,u){var a,f,l,c;if(s&&typeof s===O&&!s.nodeType&&!s.markup&&!s.getTgt){for(l in s)r(l,s[l],o);return P}return o===n&&(o=s,s=n),s&&""+s!==s&&(u=o,o=s,s=n),c=u?u[i]=u[i]||{}:r,f=t.compile,o===null?s&&delete c[s]:(o=f?o=f(s,o,u):o,s&&(c[s]=o)),f&&o&&(o._is=e),o&&(a=Ct.onStore[e])&&a(s,o,f),o}var i=e+"s";P[i]=r,D[e]=t}function at(e,t,n){var r=this.jquery&&(this[0]||ht('Unknown template: "'+this.selector+'"')),i=r.getAttribute(M);return lt.call(i?St[i]:St(r),e,t,n)}function ft(e,t,n){if(kt._dbgMode)try{return e.fn(t,n,P)}catch(r){return ht(r,n)}return e.fn(t,n,P)}function lt(e,t,n,r,s,o){var u=this;return!r&&u.fn._nvw&&!i.isArray(e)?ft(u,e,{tmpl:u}):ct.call(u,e,t,n,r,s,o)}function ct(e,t,r,s,o,u){var a,f,l,c,h,p,d,v,m,g,y,b,w,E,S=this,x="";!!t===t&&(r=t,t=n),typeof t!==O&&(t=n),o===!0&&(d=!0,o=0),S.tag?(v=S,S=S.tag,g=S._,b=S.tagName,w=g.tmpl||v.tmpl,g.noVws=E=S.attr&&S.attr!==A,t=wt(t,S.ctx),m=v.content,v.props.link===!1&&(t=t||{},t.link=!1),s=s||v.view,e=arguments.length?e:s):w=S;if(w){!s&&e&&e._is==="view"&&(s=e),s&&(m=m||s.content,u=u||s._.onRender,e===s&&(e=s.data),t=wt(t,s.ctx));if(!s||s.type==="top")(t=t||{}).root=e;w.fn||(w=St[w]||St(w));if(w){u=(t&&t.link)!==!1&&!E&&u,y=u,u===!0&&(y=n,u=s._.onRender),t=w.helpers?wt(w.helpers,t):t;if(i.isArray(e)&&!r){c=d?s:o!==n&&s||new tt(t,"array",s,e,w,o,m,u);for(a=0,f=e.length;a<f;a++)l=e[a],h=new tt(t,"item",c,l,w,(o||0)+a,m,u),p=ft(w,l,h),x+=c._.onRender?c._.onRender(p,h):p}else{if(s||!w.fn._nvw)c=d?s:new tt(t,b||"data",s,e,w,o,m,u),g&&!S.flow&&(c.tag=S);x+=ft(w,e,c)}return y?y(x,c):x}}return""}function ht(e,t,n){var r=kt.onError(e,t,n);if(""+e===e)throw new Ct.Err(r);return!t.linkCtx&&t.linked?xt.html(r):r}function pt(e){ht("Syntax error\n"+e)}function dt(e,t,n,r,i){function s(t){t-=y,t&&S.push(e.substr(y,t).replace(m,"\\n"))}function u(t){t&&pt('Unmatched or missing tag: "{{/'+t+'}}" in template:\n'+e)}function a(o,a,f,l,h,v,N,C,k,L,O,M){v&&(h=":",l=A),L=L||n&&!i;var _=(a||n)&&[[]],D="",P="",H="",B="",j="",F="",I="",q="",R=!L&&!h&&!N;f=f||(k=k||"#data",h),s(M),y=M+o.length,C?d&&S.push(["*","\n"+k.replace(g,"$1")+"\n"]):f?(f==="else"&&(w.test(k)&&pt('for "{{else if expr}}" use "{{else expr}}"'),_=x[7]&&[[]],x[8]=e.substring(x[8],M),x=E.pop(),S=x[2],R=!0),k&&yt(k.replace(m," "),_,t).replace(b,function(e,t,n,r,i,s,o,u){return o?(P+=s+",",B+="'"+u+"',"):n?(H+=r+s+",",F+=r+"'"+u+"',"):t?I+=s:(i==="trigger"&&(q+=s),D+=r+s+",",j+=r+"'"+u+"',",p=p||T.test(i)),""}).slice(0,-1),_&&_[0]&&_.pop(),c=[f,l||!!r||p||"",R&&[],mt(B,j,F),mt(P,D,H),I,q,_||0],S.push(c),R&&(E.push(x),x=c,x[8]=y)):O&&(u(O!==x[0]&&x[0]!=="else"&&O),x[8]=e.substring(x[8],M),x=E.pop()),u(!x&&O),S=x[2]}var l,c,p,d=t&&t.allowCode,v=[],y=0,E=[],S=v,x=[,,v];return n&&(e=f+e+h),u(E[0]&&E[0][2].pop()[0]),e.replace(o,a),s(e.length),(y=v[v.length-1])&&u(""+y!==y&&+y[8]===y[8]&&y[0]),n?(l=bt(v,e,n),vt(l,[v[0][7]])):l=bt(v,t),l._nvw&&(l._nvw=!/[~#]/.test(e)),l}function vt(e,t){var n,r,i=0,s=t.length;e.deps=[];for(;i<s;i++){r=t[i];for(n in r)n!=="_jsvto"&&r[n].length&&(e.deps=e.deps.concat(r[n]))}e.paths=r}function mt(e,t,n){return[e.slice(0,-1),t.slice(0,-1),n.slice(0,-1)]}function gt(e,t){return"\n "+(t?t+":{":"")+"args:["+e[0]+"]"+(e[1]||!t?",\n  props:{"+e[1]+"}":"")+(e[2]?",\n  ctx:{"+e[2]+"}":"")}function yt(e,t,n){function r(r,v,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F){function W(e,n,r,o,u,a,l,c){var p=r===".";if(r){x=x.slice(n.length),p||(e=(o?'view.hlp("'+o+'")':u?"view":"data")+(c?(a?"."+a:o?"":u?"":"."+r)+(l||""):(c=o?"":u?a||"":r,"")),e+=c?"."+c:"",e=n+(e.slice(0,9)==="view.data"?e.slice(5):e));if(f){R=i==="linkTo"?s=t._jsvto=t._jsvto||[]:h.bd;if(U=p&&R[R.length-1]){if(U._jsv){while(U.sb)U=U.sb;U.bnd&&(x="^"+x.slice(1)),U.sb=x,U.bnd=U.bnd||x.charAt(0)==="^"}}else R.push(x);w[y]=j+(p?1:0)}}return e}S=f&&S,S&&!C&&(x=S+x),T=T||"",E=E||v||O,x=x||k,L=L||H||"";var I,q,R,U,z;if(!(N&&!a&&!u)){if(f&&P&&!a&&!u)if(!i||o||s){I=w[y-1];if(F.length-1>j-(I||0)){I=F.slice(I,j+r.length);if(q!==!0){R=s||p[y-1].bd,U=R[R.length-1];if(U&&U.prm){while(U.sb&&U.sb.prm)U=U.sb;z=U.sb={path:U.sb,bnd:U.bnd}}else R.push(z={path:R.pop()})}P=l+":"+I+" onerror=''"+c,q=g[P],q||(g[P]=!0,g[P]=q=dt(P,n,!0)),q!==!0&&z&&(z._jsv=q,z.prm=h.bd,z.bnd=z.bnd||z.path&&z.path.indexOf("^")>=0)}}return a?(a=!M,a?r:'"'):u?(u=!_,u?r:'"'):(E?(w[y]=j++,h=p[++y]={bd:[]},E):"")+(B?y?"":(m=F.slice(m,j),i?(i=o=s=!1,"\b"):"\b,")+m+(m=j+r.length,f&&t.push(h.bd=[]),"\b"):C?(y&&pt(e),f&&t.pop(),i=x,o=S,m=j+r.length,S&&(f=h.bd=t[i]=[]),x+":"):x?x.split("^").join(".").replace(d,W)+(L?(h=p[++y]={bd:[]},b[y]=!0,L):T):T?T:D?(b[y]=!1,h=p[--y],D)+(L?(h=p[++y],b[y]=!0,L):""):A?(b[y]||pt(e),","):v?"":(a=M,u=_,'"'))}pt(e)}var i,s,o,u,a,f=t&&t[0],h={bd:f},p={0:h},m=0,g=n?n.links:f&&(f.links=f.links||{}),y=0,b={},w={};return(e+(n?" ":"")).replace(v,r)}function bt(e,t,r){var i,s,o,u,a,f,l,c,h,p,d,v,g,y,b,w,E,S,x,T,N,C,k,L,O,M,_,D,P,H,B,j=0,F="",I={},q=e.length;""+t===t?(x=r?'data-link="'+t.replace(m," ").slice(1,-1)+'"':t,t=0):(x=t.tmplName||"unnamed",t.allowCode&&(I.allowCode=!0),t.debug&&(I.debug=!0),v=t.bnds,S=t.tmpls);for(i=0;i<q;i++){s=e[i];if(""+s===s)F+='\n+"'+s+'"';else{o=s[0];if(o==="*")F+=";\n"+s[1]+"\nret=ret";else{u=s[1],C=!r&&s[2],a=gt(s[3],"params")+"},"+gt(y=s[4]),P=s[5],B=s[6],k=s[8],(M=o==="else")?g&&g.push(s[7]):(j=0,v&&(g=s[7])&&(g=[g],j=v.push(1))),(_=o===":")?u&&(o=u===A?">":u+o):(C&&(T=ot(k,I),T.tmplName=x+"/"+o,bt(C,T),S.push(T)),M||(N=o,O=F,F=""),L=e[i+1],L=L&&L[0]==="else"),H=P?";\ntry{\nret+=":"\n+",b="",w="";if(_&&(g||B||u&&u!==A)){D="return {"+a+"};",E='c("'+u+'",view,',D=new Function("data,view,j,u"," // "+x+" "+j+" "+o+"\n"+D),D._er=P,b=E+j+",",w=")",D._tag=o;if(r)return D;vt(D,g),d=!0}F+=_?(r?(P?"\ntry{\n":"")+"return ":H)+(d?(d=n,p=h=!0,E+(g?(v[j-1]=D,j):"{"+a+"}")+")"):o===">"?(l=!0,"h("+y[0]+")"):(c=!0,"((v="+(y[0]||"data")+')!=null?v:"")')):(p=f=!0,"\n{view:view,tmpl:"+(C?S.length:"0")+","+a+"},");if(N&&!L){F="["+F.slice(0,-1)+"]",E='t("'+N+'",view,this,';if(r||g){F=new Function("data,view,j,u"," // "+x+" "+j+" "+N+"\nreturn "+F+";"),F._er=P,F._tag=N,g&&vt(v[j-1]=F,g);if(r)return F;b=E+j+",undefined,",w=")"}F=O+H+E+(j||F)+")",g=0,N=0}P&&(p=!0,F+=";\n}catch(e){ret"+(r?"urn ":"+=")+b+"j._err(e,view,"+P+")"+w+";}"+(r?"":"ret=ret"))}}}F="// "+x+"\nvar v"+(f?",t=j._tag":"")+(h?",c=j._cnvt":"")+(l?",h=j.converters.html":"")+(r?";\n":',ret=""\n')+(I.debug?"debugger;":"")+F+(r?"\n":";\nreturn ret;");try{F=new Function("data,view,j,u",F)}catch(R){pt("Compiled template code:\n\n"+F+'\n: "'+R.message+'"')}return t&&(t.fn=F),p||(F._nvw=!0),F}function wt(e,t){return e&&e!==t?t?W(W({},t),e):e:t&&W({},t)}function Et(e){return L[e]||(L[e]="&#"+e.charCodeAt(0)+";")}function Lt(e){var t,n,r=[];if(typeof e===O)for(t in e){n=e[t];if(!n||!n.toJSON||n.toJSON())X(n)||r.push({key:t,prop:n})}return r}function At(e){return e!=null?x.test(e)&&(""+e).replace(N,Et)||e:""}if(t&&t.render||e.jsviews)return;var r="v1.0.0-beta",i,s,o,u,a,f="{",l="{",c="}",h="}",p="^",d=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,v=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*[.^]|\s*$|[^\(\[])|[)\]])([([]?))|(\s+)/g,m=/[ \t]*(\r\n|\n|\r)/g,g=/\\(['"])/g,y=/['"\\]/g,b=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,w=/^if\s/,E=/<(\w+)[>\s]/,S=/[\x00`><"'&]/g,x=/[\x00`><\"'&]/,T=/^on[A-Z]|^convert(Back)?$/,N=S,C=0,k=0,L={"&":"&amp;","<":"&lt;",">":"&gt;","\0":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;"},A="html",O="object",M="data-jsv-tmpl",_={},D={template:{compile:it},tag:{compile:rt},helper:{},converter:{}},P={jsviews:r,settings:function(e){W(kt,e),U(kt._dbgMode),kt.jsv&&kt.jsv()},sub:{View:tt,Err:z,tmplFn:dt,cvt:Y,parse:yt,extend:W,syntaxErr:pt,onStore:{},_lnk:I,_ths:F},map:st,_cnvt:G,_tag:et,_err:ht};(z.prototype=new Error).constructor=z,J.depends=function(){return[this.get("item"),"index"]},K.depends="index",tt.prototype={get:$,getIndex:K,getRsc:Z,hlp:Q,_is:"view"};for(s in D)ut(s,D[s]);var St=P.templates,xt=P.converters,Tt=P.helpers,Nt=P.tags,Ct=P.sub,kt=P.settings;t?(i=t,i.fn.render=at,i.observable&&(W(Ct,i.views.sub),P.map=i.views.map)):(i=e.jsviews={},i.isArray=Array&&Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}),i.render=_,i.views=P,i.templates=St=P.templates,kt({debugMode:U,delimiters:V,onError:function(e,t,r){return t&&(e=r===n?"{Error: "+e+"}":X(r)?r(e,t):r),e==n?"":e},_dbgMode:!0}),Nt({"else":function(){},"if":{render:function(e){var t=this,n=t.rendering.done||!e&&(arguments.length||!t.tagCtx.index)?"":(t.rendering.done=!0,t.selected=t.tagCtx.index,t.tagCtx.render(t.tagCtx.view,!0));return n},onUpdate:function(e,t,n){var r,i,s;for(r=0;(i=this.tagCtxs[r])&&i.args.length;r++){i=i.args[0],s=!i!=!n[r].args[0];if(!this.convert&&!!i||s)return s}return!1},flow:!0},"for":{render:function(e){var t,r=this,s=r.tagCtx,o="",u=0;if(!r.rendering.done){if(t=!arguments.length)e=s.view.data;e!==n&&(o+=s.render(e,t),u+=i.isArray(e)?e.length:1);if(r.rendering.done=u)r.selected=s.index}return o},flow:!0},include:{flow:!0},"*":{render:I,flow:!0}}),Nt("props",{baseTag:"for",dataMap:st(Lt)}),xt({html:At,attr:At,url:function(e){return e!=n?encodeURI(""+e):e===null?e:""}}),V()}(this,this.jQuery),jQuery.fn.templates}.apply(e,arguments)})}(this);var i=n("simplelayout/Simplelayout"),s=n("toolbox/Toolbox");n("jsrender"),n("matchHeight"),window.Simplelayout=i,window.Toolbox=s})($);