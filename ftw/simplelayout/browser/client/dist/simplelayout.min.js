/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */

/*!
 * EventEmitter v4.2.11 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - http://oli.me.uk/
 * @preserve
 */

/*! JsRender v0.9.80 (Beta): http://jsviews.com/#jsrender */

/*! **VERSION FOR WEB** (For NODE.JS see http://jsviews.com/download/jsrender-node.js) */

/*
 * jQuery css bezier animation support -- Jonah Fox
 * version 0.0.1
 * Released under the MIT license.
 */

(function(e,t){e.Simplelayout=t().simplelayout,e.Toolbox=t().toolbox})(this,function(){var e,t,n;return function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.slice(0,v.length-1).concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){var n=p.call(arguments,0);return typeof n[0]!="string"&&n.length===1&&n.push(null),s.apply(r,n.concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){if(typeof e!="string")throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("almond/almond",function(){}),function(){"use strict";function e(){}function t(e,t){for(var n=e.length;n--;)if(e[n].listener===t)return n;return-1}function r(e){return function(){return this[e].apply(this,arguments)}}var i=e.prototype,s=this,o=s.EventEmitter;i.getListeners=function(e){var t,n,r=this._getEvents();if(e instanceof RegExp){t={};for(n in r)r.hasOwnProperty(n)&&e.test(n)&&(t[n]=r[n])}else t=r[e]||(r[e]=[]);return t},i.flattenListeners=function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(e[t].listener);return n},i.getListenersAsObject=function(e){var t,n=this.getListeners(e);return n instanceof Array&&(t={},t[e]=n),t||n},i.addListener=function(e,n){var r,i=this.getListenersAsObject(e),s="object"==typeof n;for(r in i)i.hasOwnProperty(r)&&-1===t(i[r],n)&&i[r].push(s?n:{listener:n,once:!1});return this},i.on=r("addListener"),i.addOnceListener=function(e,t){return this.addListener(e,{listener:t,once:!0})},i.once=r("addOnceListener"),i.defineEvent=function(e){return this.getListeners(e),this},i.defineEvents=function(e){for(var t=0;t<e.length;t+=1)this.defineEvent(e[t]);return this},i.removeListener=function(e,n){var r,i,s=this.getListenersAsObject(e);for(i in s)s.hasOwnProperty(i)&&(r=t(s[i],n),-1!==r&&s[i].splice(r,1));return this},i.off=r("removeListener"),i.addListeners=function(e,t){return this.manipulateListeners(!1,e,t)},i.removeListeners=function(e,t){return this.manipulateListeners(!0,e,t)},i.manipulateListeners=function(e,t,n){var r,i,s=e?this.removeListener:this.addListener,o=e?this.removeListeners:this.addListeners;if("object"!=typeof t||t instanceof RegExp)for(r=n.length;r--;)s.call(this,t,n[r]);else for(r in t)t.hasOwnProperty(r)&&(i=t[r])&&("function"==typeof i?s.call(this,r,i):o.call(this,r,i));return this},i.removeEvent=function(e){var t,n=typeof e,r=this._getEvents();if("string"===n)delete r[e];else if(e instanceof RegExp)for(t in r)r.hasOwnProperty(t)&&e.test(t)&&delete r[t];else delete this._events;return this},i.removeAllListeners=r("removeEvent"),i.emitEvent=function(e,t){var n,r,i,s,o=this.getListenersAsObject(e);for(i in o)if(o.hasOwnProperty(i))for(r=o[i].length;r--;)n=o[i][r],n.once===!0&&this.removeListener(e,n.listener),s=n.listener.apply(this,t||[]),s===this._getOnceReturnValue()&&this.removeListener(e,n.listener);return this},i.trigger=r("emitEvent"),i.emit=function(e){var t=Array.prototype.slice.call(arguments,1);return this.emitEvent(e,t)},i.setOnceReturnValue=function(e){return this._onceReturnValue=e,this},i._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},i._getEvents=function(){return this._events||(this._events={})},e.noConflict=function(){return s.EventEmitter=o,e},"function"==typeof n&&n.amd?n("EventEmitter",[],function(){return e}):"object"==typeof module&&module.exports?module.exports=e:s.EventEmitter=e}.call(this),n("app/simplelayout/EventEmitter",["EventEmitter"],function(e){"use strict";function r(){this.trigger=function(e,n){$(document).trigger(e,n),t.trigger(e,n)},this.on=function(e,n){t.on(e,n)}}var t=null,n=null;return r.getInstance=function(){return n===null&&(t=new e,n=new r),n},r.getInstance()}),n("app/simplelayout/transactional",["app/simplelayout/EventEmitter"],function(e){"use strict";var t=function(){this.committed=!1,this.commit=function(){if(this.committed)throw new Error("Transaction is already committed");return this.committed=!0,e.trigger(this.name+"-committed",[this]),this},this.rollback=function(){if(!this.committed)throw new Error("Transaction on not yet committed");return this.committed=!1,e.trigger(this.name+"-rollbacked",[this]),this}};return t}),n("app/simplelayout/idHelper",[],function(){"use strict";return{createGUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e==="x"?t:t&3|8;return n.toString(16)})}}}),!function(e,t){var r=t.jQuery;"object"==typeof exports?module.exports=r?e(t,r):function(n){if(n&&!n.fn)throw"Provide jQuery or null";return e(t,n)}:"function"==typeof n&&n.amd?n("jsrender",[],function(){return e(t)}):e(t,!1)}(function(e,t){"use strict";function n(e,t){return function(){var n,r=this,i=r.base;return r.base=e,n=t.apply(r,arguments),r.base=i,n}}function r(e,t){return et(t)&&(t=n(e?e._d?e:n(o,e):o,t),t._d=1),t}function i(e,t){for(var n in t.props)Lt.test(n)&&(e[n]=r(e[n],t.props[n]))}function s(e){return e}function o(){return""}function u(e){try{throw console.log("JsRender dbg breakpoint: "+e),"dbg breakpoint"}catch(t){}return this.base?this.baseApply(arguments):e}function a(e){this.name=(t.link?"JsViews":"JsRender")+" Error",this.message=e||this.name}function f(e,t){for(var n in t)e[n]=t[n];return e}function l(e,t,n){return e?tt(e)?l.apply(Y,e):(ut.delimiters=[e,t,dt=n?n.charAt(0):dt],lt=e.charAt(0),ct=e.charAt(1),ht=t.charAt(0),pt=t.charAt(1),e="\\"+lt+"(\\"+dt+")?\\"+ct,t="\\"+ht+"\\"+pt,Q="(?:(\\w+(?=[\\/\\s\\"+ht+"]))|(\\w+)?(:)|(>)|(\\*))\\s*((?:[^\\"+ht+"]|\\"+ht+"(?!\\"+pt+"))*?)",ot.rTag="(?:"+Q+")",Q=new RegExp("(?:"+e+Q+"(\\/)?|\\"+lt+"(\\"+dt+")?\\"+ct+"(?:(?:\\/(\\w+))\\s*|!--[\\s\\S]*?--))"+t,"g"),ot.rTmpl=new RegExp("<.*>|([^\\\\]|^)[{}]|"+e+".*"+t),ft):ut.delimiters}function c(e,t){t||e===!0||(t=e,e=void 0);var n,r,i,s,o=this,u=!t||"root"===t;if(e){if(s=t&&o.type===t&&o,!s)if(n=o.views,o._.useKey){for(r in n)if(s=t?n[r].get(e,t):n[r])break}else for(r=0,i=n.length;!s&&i>r;r++)s=t?n[r].get(e,t):n[r]}else if(u)for(;o.parent;)s=o,o=o.parent;else for(;o&&!s;)s=o.type===t?o:void 0,o=o.parent;return s}function h(){var e=this.get("item");return e?e.index:void 0}function p(){return this.index}function d(t,n){var r,i,s=this,o=s.ctx;if(o&&(o=o[t]),void 0===o&&(o=it[t]),o&&o._cp){if(n)return i=ot._ceo(o[1].deps),i.unshift(o[0].data),i._cp=!0,i;o=Y.getCtx(o)}return o&&et(o)&&!o._wrp&&(r=function(){return o.apply(this&&this!==e?this:s,arguments)},r._wrp=s,f(r,o)),r||o}function v(e){return e&&(e.fn?e:this.getRsc("templates",e)||nt(e))}function m(e,t,n,r){var s,o,u="number"==typeof n&&t.tmpl.bnds[n-1],a=t.linkCtx;return void 0!==r?n=r={props:{},args:[r]}:u&&(n=u(t.data,t,ot)),o=n.args[0],(e||u)&&(s=a&&a.tag,s||(s=f(new ot._tg,{_:{inline:!a,bnd:u,unlinked:!0},tagName:":",cvt:e,flow:!0,tagCtx:n}),a&&(a.tag=s,s.linkCtx=a),n.ctx=z(n.ctx,(a?a.view:t).ctx)),s._er=r&&o,i(s,n),n.view=t,s.ctx=n.ctx||s.ctx||{},n.ctx=void 0,o=s.cvtArgs("true"!==e&&e)[0],o=u&&t._.onRender?t._.onRender(o,t,s):o),void 0!=o?o:""}function g(e){var t=this,n=t.tagCtx,r=n.view,i=n.args;return e=e||t.convert,e=e&&(""+e===e?r.getRsc("converters",e)||H("Unknown converter: '"+e+"'"):e),i=i.length||n.index?e?i.slice():i:[r.data],e&&(e.depends&&(t.depends=ot.getDeps(t.depends,t,e.depends,e)),i[0]=e.apply(t,i)),i}function y(e,t){for(var n,r,i=this;void 0===n&&i;)r=i.tmpl&&i.tmpl[e],n=r&&r[t],i=i.parent;return n||Y[e][t]}function b(e,t,n,r,s,o){t=t||G;var u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C="",k=t.linkCtx||0,L=t.ctx,A=n||t.tmpl,O="number"==typeof r&&t.tmpl.bnds[r-1];for("tag"===e._is?(u=e,e=u.tagName,r=u.tagCtxs,f=u.template):(a=t.getRsc("tags",e)||H("Unknown tag: {{"+e+"}} "),f=a.template),void 0!==o?(C+=o,r=o=[{props:{},args:[]}]):O&&(r=O(t.data,t,ot)),d=r.length,p=0;d>p;p++)m=r[p],(!k||!k.tag||p&&!k.tag._.inline||u._er)&&((y=A.tmpls&&m.tmpl)&&(y=m.content=A.tmpls[y-1]),m.index=p,m.tmpl=y,m.render=_,m.view=t,m.ctx=z(m.ctx,L)),(n=m.props.tmpl)&&(m.tmpl=t.getTmpl(n)),u||(u=new a._ctr,b=!!u.init,u.parent=h=L&&L.tag,u.tagCtxs=r,N=u.dataMap,k&&(u._.inline=!1,k.tag=u,u.linkCtx=k),(u._.bnd=O||k.fn)?u._.arrVws={}:u.dataBoundOnly&&H("{^{"+e+"}} tag must be data-bound")),r=u.tagCtxs,N=u.dataMap,m.tag=u,N&&r&&(m.map=r[p].map),u.flow||(g=m.ctx=m.ctx||{},l=u.parents=g.parentTags=L&&z(g.parentTags,L.parentTags)||{},h&&(l[h.tagName]=h),l[u.tagName]=g.tag=u);if(!(u._er=o)){for(i(u,r[0]),u.rendering={},p=0;d>p;p++)m=u.tagCtx=r[p],x=m.props,S=u.cvtArgs(),(w=x.dataMap||N)&&(S.length||x.dataMap)&&(E=m.map,E&&E.src===S[0]&&!s||(E&&E.src&&E.unmap(),E=m.map=w.map(S[0],x,void 0,!u._.bnd)),S=[E.tgt]),u.ctx=m.ctx,p||(b&&(T=u.template,u.init(m,k,u.ctx),b=void 0),k&&(k.attr=u.attr=k.attr||u.attr),c=u.attr,u._.noVws=c&&c!==_t),v=void 0,u.render&&(v=u.render.apply(u,S)),S.length||(S=[t]),void 0===v&&(v=m.render(S[0],!0)||(s?void 0:"")),C=C?C+(v||""):v;u.rendering=void 0}return u.tagCtx=r[0],u.ctx=u.tagCtx.ctx,u._.noVws&&u._.inline&&(C="text"===c?rt.html(C):""),O&&t._.onRender?t._.onRender(C,t,u):C}function w(e,t,n,r,i,s,o,u){var a,f,l,c=this,p="array"===t;c.content=u,c.views=p?[]:{},c.parent=n,c.type=t||"top",c.data=r,c.tmpl=i,l=c._={key:0,useKey:p?0:1,id:""+Ot++,onRender:o,bnds:{}},c.linked=!!o,n?(a=n.views,f=n._,f.useKey?(a[l.key="_"+f.useKey++]=c,c.index=Bt,c.getIndex=h):a.length===(l.key=c.index=s)?a.push(c):a.splice(s,0,c),c.ctx=e||n.ctx):c.ctx=e}function E(e){var t,n,r;for(t in qt)n=t+"s",e[n]&&(r=e[n],e[n]={},Y[n](r,e))}function S(e,t,n){function i(){var t=this;t._={inline:!0,unlinked:!0},t.tagName=e}var s,o,u,a=new ot._tg;if(et(t)?t={depends:t.depends,render:t}:""+t===t&&(t={template:t}),o=t.baseTag){t.flow=!!t.flow,t.baseTag=o=""+o===o?n&&n.tags[o]||st[o]:o,a=f(a,o);for(u in t)a[u]=r(o[u],t[u])}else a=f(a,t);return void 0!==(s=a.template)&&(a.template=""+s===s?nt[s]||nt(s):s),a.init!==!1&&((i.prototype=a).constructor=a._ctr=i),n&&(a._parentTmpl=n),a}function x(e){return this.base.apply(this,e)}function T(e,n,r,i){function s(n){var s,u;if(""+n===n||n.nodeType>0&&(o=n)){if(!o)if(/^\.\/[^\\:*?"<>]*$/.test(n))(u=nt[e=e||n])?n=u:o=document.getElementById(n);else if(t.fn&&!ot.rTmpl.test(n))try{o=t(document).find(n)[0]}catch(a){}o&&(i?n=o.innerHTML:(s=o.getAttribute(Pt),s?s!==Ht?(n=nt[s],delete nt[s]):t.fn&&(n=t.data(o)[Ht]):(e=e||(t.fn?Ht:n),n=T(e,o.innerHTML,r,i)),n.tmplName=e=e||s,e!==Ht&&(nt[e]=n),o.setAttribute(Pt,e),t.fn&&t.data(o,Ht,n))),o=void 0}else n.fn||(n=void 0);return n}var o,u,a=n=n||"";return 0===i&&(i=void 0,a=s(a)),i=i||(n.markup?n:{}),i.tmplName=e,r&&(i._parentTmpl=r),!a&&n.markup&&(a=s(n.markup))&&a.fn&&(a=a.markup),void 0!==a?(a.fn||n.fn?a.fn&&(u=a):(n=L(a,i),j(a.replace(St,"\\$&"),n)),u||(u=f(function(){return u.render.apply(u,arguments)},n),E(u)),e&&!r&&e!==Ht&&(jt[e]=u),u):void 0}function N(e,n){return t.isFunction(e)?e.call(n):e}function C(e){var t,n=[],r=e.length;for(t=0;r>t;t++)n.push(e[t].unmap());return n}function k(e,n){function r(e){l.apply(this,e)}function i(){return new r(arguments)}function s(e,t){var n,r,i,s,o,u=h.length;for(n=0;u>n;n++)s=h[n],r=void 0,s+""!==s&&(r=s,s=r.getter),void 0===(o=e[s])&&r&&void 0!==(i=r.defaultVal)&&(o=N(i,e)),t(o,r&&c[r.type],s)}function o(t){t=t+""===t?JSON.parse(t):t;var n,r,i,o=t,f=[];if(tt(t)){for(t=t||[],r=t.length,n=0;r>n;n++)f.push(this.map(t[n]));return f._is=e,f.unmap=a,f.merge=u,f}if(t){s(t,function(e,t){t&&(e=t.map(e)),f.push(e)}),o=this.apply(this,f);for(i in t)i===Z||w[i]||(o[i]=t[i])}return o}function u(e){e=e+""===e?JSON.parse(e):e;var t,n,r,o,u,a,f,l,c,h,p=this;if(tt(p)){for(l={},h=[],r=e.length,o=p.length,t=0;r>t;t++){for(c=e[t],f=!1,n=0;o>n&&!f;n++)l[n]||(a=p[n],d&&(l[n]=f=d+""===d?c[d]&&(w[d]?a[d]():a[d])===c[d]:d(a,c)));f?(a.merge(c),h.push(a)):h.push(i.map(c))}return void (b?b(p).refresh(h,!0):p.splice.apply(p,[0,p.length].concat(h)))}s(e,function(e,t,n){t?p[n]().merge(e):p[n](e)});for(u in e)u===Z||w[u]||(p[u]=e[u])}function a(){var e,n,r,i,s,o,u=this;if(tt(u))return C(u);for(e={},i=h.length,r=0;i>r;r++)n=h[r],s=void 0,n+""!==n&&(s=n,n=s.getter),o=u[n](),e[n]=s&&o&&c[s.type]?tt(o)?C(o):o.unmap():o;for(n in u)"_is"===n||w[n]||n===Z||"_"===n.charAt(0)&&w[n.slice(1)]||t.isFunction(u[n])||(e[n]=u[n]);return e}var f,l,c=this,h=n.getters,p=n.extend,d=n.id,v=t.extend({_is:e||"unnamed",unmap:a,merge:u},p),m="",g="",y=h?h.length:0,b=t.observable,w={};for(r.prototype=v,f=0;y>f;f++)!function(e){e=e.getter||e,w[e]=f+1;var t="_"+e;m+=(m?",":"")+e,g+="this."+t+" = "+e+";\n",v[e]=v[e]||function(n){return arguments.length?void (b?b(this).setProperty(e,n):this[t]=n):this[t]},b&&(v[e].set=v[e].set||function(e){this[t]=e})}(h[f]);return l=new Function(m,g.slice(0,-1)),l.prototype=v,v.constructor=l,i.map=o,i.getters=h,i.extend=p,i.id=d,i}function L(e,n){var r,i=at._wm||{},s=f({tmpls:[],links:{},bnds:[],_is:"template",render:_},n);return s.markup=e,n.htmlTag||(r=Nt.exec(e),s.htmlTag=r?r[1].toLowerCase():""),r=i[s.htmlTag],r&&r!==i.div&&(s.markup=t.trim(s.markup)),s}function A(e,t){function n(i,s,o){var u,a,f,l;if(i&&typeof i===Dt&&!i.nodeType&&!i.markup&&!i.getTgt&&!("viewModel"===e&&i.getters||i.extend)){for(f in i)n(f,i[f],s);return s||Y}return void 0===s&&(s=i,i=void 0),i&&""+i!==i&&(o=s,s=i,i=void 0),l=o?"viewModel"===e?o:o[r]=o[r]||{}:n,a=t.compile,null===s?i&&delete l[i]:(s=a?a.call(l,i,s,o,0):s,i&&(l[i]=s)),a&&s&&(s._is=e),s&&(u=ot.onStore[e])&&u(i,s,a),s}var r=e+"s";Y[r]=n}function O(e){ft[e]=function(t){return arguments.length?(ut[e]=t,ft):ut[e]}}function M(e){function t(t,n){this.tgt=e.getTgt(t,n)}return et(e)&&(e={getTgt:e}),e.baseMap&&(e=f(f({},e.baseMap),e)),e.map=function(e,n){return new t(e,n)},e}function _(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d=r,v="";if(t===!0?(n=t,t=void 0):typeof t!==Dt&&(t=void 0),(a=this.tag)?(l=this,d=d||l.view,f=d.getTmpl(a.template||l.tmpl),arguments.length||(e=d)):f=this,f){if(!d&&e&&"view"===e._is&&(d=e),d&&e===d&&(e=d.data),c=!d,mt=mt||c,d||((t=t||{}).root=e),!mt||at.useViews||f.useViews||d&&d!==G)v=D(f,e,t,n,d,i,s,a);else{if(d?(h=d.data,p=d.index,d.index=Bt):(d=G,d.data=e,d.ctx=t),tt(e)&&!n)for(o=0,u=e.length;u>o;o++)d.index=o,d.data=e[o],v+=f.fn(e[o],d,ot);else d.data=e,v+=f.fn(e,d,ot);d.data=h,d.index=p}c&&(mt=void 0)}return v}function D(e,t,n,r,i,s,o,u){function a(e){E=f({},n),E[b]=e}var l,c,h,p,d,v,m,g,y,b,E,S,x="";if(u&&(y=u.tagName,S=u.tagCtx,n=n?z(n,u.ctx):u.ctx,e===i.content?m=e!==i.ctx._wrp?i.ctx._wrp:void 0:e!==S.content?e===u.template?(m=S.tmpl,n._wrp=S.content):m=S.content||i.content:m=i.content,S.props.link===!1&&(n=n||{},n.link=!1),(b=S.props.itemVar)&&("~"!==b.charAt(0)&&B("Use itemVar='~myItem'"),b=b.slice(1))),i&&(o=o||i._.onRender,n=z(n,i.ctx)),s===!0&&(v=!0,s=0),o&&(n&&n.link===!1||u&&u._.noVws)&&(o=void 0),g=o,o===!0&&(g=void 0,o=i._.onRender),n=e.helpers?z(e.helpers,n):n,E=n,tt(t)&&!r)for(h=v?i:void 0!==s&&i||new w(n,"array",i,t,e,s,o),i&&i._.useKey&&(h._.bnd=!u||u._.bnd&&u),b&&(h.it=b),b=h.it,l=0,c=t.length;c>l;l++)b&&a(t[l]),p=new w(E,"item",h,t[l],e,(s||0)+l,o,m),d=e.fn(t[l],p,ot),x+=h._.onRender?h._.onRender(d,p):d;else b&&a(t),h=v?i:new w(E,y||"data",i,t,e,s,o,m),u&&!u.flow&&(h.tag=u),x+=e.fn(t,h,ot);return g?g(x,h):x}function P(e,t,n){var r=void 0!==n?et(n)?n.call(t.data,e,t):n||"":"{Error: "+e.message+"}";return ut.onError&&void 0!==(n=ut.onError.call(t.data,e,n&&r,t))&&(r=n),t&&!t.linkCtx?rt.html(r):r}function H(e){throw new ot.Err(e)}function B(e){H("Syntax error\n"+e)}function j(e,t,n,r,i){function s(t){t-=v,t&&g.push(e.substr(v,t).replace(wt,"\\n"))}function o(t,n){t&&(t+="}}",B((n?"{{"+n+"}} block has {{/"+t+" without {{"+t:"Unmatched or missing {{/"+t)+", in template:\n"+e))}function u(u,a,f,h,d,b,w,E,S,x,T,N){(w&&a||S&&!f||E&&":"===E.slice(-1)||x)&&B(u),b&&(d=":",h=_t),S=S||n&&!i;var C=(a||n)&&[[]],k="",L="",A="",O="",M="",_="",D="",P="",H=!S&&!d;f=f||(E=E||"#data",d),s(N),v=N+u.length,w?p&&g.push(["*","\n"+E.replace(/^:/,"ret+= ").replace(Et,"$1")+";\n"]):f?("else"===f&&(Tt.test(E)&&B('for "{{else if expr}}" use "{{else expr}}"'),C=y[7]&&[[]],y[8]=e.substring(y[8],N),y=m.pop(),g=y[2],H=!0),E&&R(E.replace(wt," "),C,t).replace(xt,function(e,t,n,r,i,s,o,u){return r="'"+i+"':",o?(L+=s+",",O+="'"+u+"',"):n?(A+=r+"j._cp("+s+',"'+u+'",view),',_+=r+"'"+u+"',"):t?D+=s:("trigger"===i&&(P+=s),k+=r+s+",",M+=r+"'"+u+"',",c=c||Lt.test(i)),""}).slice(0,-1),C&&C[0]&&C.pop(),l=[f,h||!!r||c||"",H&&[],I(O||(":"===f?"'#data',":""),M,_),I(L||(":"===f?"data,":""),k,A),D,P,C||0],g.push(l),H&&(m.push(y),y=l,y[8]=v)):T&&(o(T!==y[0]&&"else"!==y[0]&&T,y[0]),y[8]=e.substring(y[8],N),y=m.pop()),o(!y&&T),g=y[2]}var a,f,l,c,h,p=ut.allowCode||t&&t.allowCode||ft.allowCode===!0,d=[],v=0,m=[],g=d,y=[,,d];if(p&&t._is&&(t.allowCode=p),n&&(void 0!==r&&(e=e.slice(0,-r.length-2)+pt),e=lt+e+pt),o(m[0]&&m[0][2].pop()[0]),e.replace(Q,u),s(e.length),(v=d[d.length-1])&&o(""+v!==v&&+v[8]===v[8]&&v[0]),n){for(f=U(d,e,n),h=[],a=d.length;a--;)h.unshift(d[a][7]);F(f,h)}else f=U(d,t);return f}function F(e,t){var n,r,i=0,s=t.length;for(e.deps=[];s>i;i++){r=t[i];for(n in r)"_jsvto"!==n&&r[n].length&&(e.deps=e.deps.concat(r[n]))}e.paths=r}function I(e,t,n){return[e.slice(0,-1),t.slice(0,-1),n.slice(0,-1)]}function q(e,t){return"\n	"+(t?t+":{":"")+"args:["+e[0]+"]"+(e[1]||!t?",\n	props:{"+e[1]+"}":"")+(e[2]?",\n	ctx:{"+e[2]+"}":"")}function R(e,t,n){function r(r,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H){function F(e,n,r,o,u,a,c,h){var p="."===r;if(r&&(w=w.slice(n.length),/^\.?constructor$/.test(h||w)&&B(e),p||(e=(o?'view.hlp("'+o+'")':u?"view":"data")+(h?(a?"."+a:o?"":u?"":"."+r)+(c||""):(h=o?"":u?a||"":r,"")),e+=h?"."+h:"",e=n+("view.data"===e.slice(0,9)?e.slice(5):e)),f)){if(R="linkTo"===i?s=t._jsvto=t._jsvto||[]:l.bd,U=p&&R[R.length-1]){if(U._jsv){for(;U.sb;)U=U.sb;U.bnd&&(w="^"+w.slice(1)),U.sb=w,U.bnd=U.bnd||"^"===w.charAt(0)}}else R.push(w);m[d]=P+(p?1:0)}return e}b&&!x&&(w=b+w),E=E||"",y=y||g||k,w=w||T,N=N||_||"";var I,q,R,U,z,W=")";if("["===N&&(N="[j._sq(",W=")]"),!S||a||u){if(f&&M&&!a&&!u&&(!i||o||s)&&(I=m[d-1],H.length-1>P-(I||0))){if(I=H.slice(I,P+r.length),q!==!0)if(R=s||c[d-1].bd,U=R[R.length-1],U&&U.prm){for(;U.sb&&U.sb.prm;)U=U.sb;z=U.sb={path:U.sb,bnd:U.bnd}}else R.push(z={path:R.pop()});M=ct+":"+I+" onerror=''"+ht,q=p[M],q||(p[M]=!0,p[M]=q=j(M,n,!0)),q!==!0&&z&&(z._jsv=q,z.prm=l.bd,z.bnd=z.bnd||z.path&&z.path.indexOf("^")>=0)}return a?(a=!L,a?r:k+'"'):u?(u=!A,u?r:k+'"'):(y?(m[d]=P++,l=c[++d]={bd:[]},y):"")+(D?d?"":(h=H.slice(h,P),(i?(i=o=s=!1,"\b"):"\b,")+h+(h=P+r.length,f&&t.push(l.bd=[]),"\b")):x?(d&&B(e),f&&t.pop(),i=w,o=b,h=P+r.length,b&&(f=l.bd=t[i]=[]),w+":"):w?w.split("^").join(".").replace(yt,F)+(N?(l=c[++d]={bd:[]},v[d]=W,N):E):E?E:O?(O=v[d]||O,v[d]=!1,l=c[--d],O+(N?(l=c[++d],v[d]=W,N):"")):C?(v[d]||B(e),","):g?"":(a=L,u=A,'"'))}B(e)}var i,s,o,u,a,f=t&&t[0],l={bd:f},c={0:l},h=0,p=(n?n.links:f&&(f.links=f.links||{}))||G.tmpl.links,d=0,v={},m={},g=(e+(n?" ":"")).replace(bt,r);return!d&&g||B(e)}function U(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,A,O,M,_,D,P=0,H=at.useViews||t.useViews||t.tags||t.templates||t.helpers||t.converters,j="",I={},R=e.length;for(""+t===t?(w=n?'data-link="'+t.replace(wt," ").slice(1,-1)+'"':t,t=0):(w=t.tmplName||"unnamed",t.allowCode&&(I.allowCode=!0),t.debug&&(I.debug=!0),p=t.bnds,b=t.tmpls),r=0;R>r;r++)if(i=e[r],""+i===i)j+='\n+"'+i+'"';else if(s=i[0],"*"===s)j+=";\n"+i[1]+"\nret=ret";else{if(o=i[1],x=!n&&i[2],u=q(i[3],"params")+"},"+q(v=i[4]),M=i[5],D=i[6],T=i[8]&&i[8].replace(Et,"$1"),(k="else"===s)?d&&d.push(i[7]):(P=0,p&&(d=i[7])&&(d=[d],P=p.push(1))),H=H||v[1]||v[2]||d||/view.(?!index)/.test(v[0]),(A=":"===s)?o&&(s=o===_t?">":o+s):(x&&(E=L(T,I),E.tmplName=w+"/"+s,E.useViews=E.useViews||H,U(x,E),H=E.useViews,b.push(E)),k||(S=s,H=H||s&&(!st[s]||!st[s].flow),C=j,j=""),N=e[r+1],N=N&&"else"===N[0]),_=M?";\ntry{\nret+=":"\n+",m="",g="",A&&(d||D||o&&o!==_t)){if(O=new Function("data,view,j,u"," // "+w+" "+P+" "+s+"\nreturn {"+u+"};"),O._er=M,O._tag=s,n)return O;F(O,d),y='c("'+o+'",view,',h=!0,m=y+P+",",g=")"}if(j+=A?(n?(M?"try{\n":"")+"return ":_)+(h?(h=void 0,H=c=!0,y+(d?(p[P-1]=O,P):"{"+u+"}")+")"):">"===s?(f=!0,"h("+v[0]+")"):(l=!0,"((v="+v[0]+")!=null?v:"+(n?"null)":'"")'))):(a=!0,"\n{view:view,tmpl:"+(x?b.length:"0")+","+u+"},"),S&&!N){if(j="["+j.slice(0,-1)+"]",y='t("'+S+'",view,this,',n||d){if(j=new Function("data,view,j,u"," // "+w+" "+P+" "+S+"\nreturn "+j+";"),j._er=M,j._tag=S,d&&F(p[P-1]=j,d),n)return j;m=y+P+",undefined,",g=")"}j=C+_+y+(P||j)+")",d=0,S=0}M&&(H=!0,j+=";\n}catch(e){ret"+(n?"urn ":"+=")+m+"j._err(e,view,"+M+")"+g+";}"+(n?"":"ret=ret"))}j="// "+w+"\nvar v"+(a?",t=j._tag":"")+(c?",c=j._cnvt":"")+(f?",h=j._html":"")+(n?";\n":',ret=""\n')+(I.debug?"debugger;":"")+j+(n?"\n":";\nreturn ret;"),ut.debugMode!==!1&&(j="try {\n"+j+"\n}catch(e){\nreturn j._err(e, view);\n}");try{j=new Function("data,view,j,u",j)}catch(z){B("Compiled template code:\n\n"+j+'\n: "'+z.message+'"')}return t&&(t.fn=j,t.useViews=!!H),j}function z(e,t){return e&&e!==t?t?f(f({},t),e):e:t&&f({},t)}function W(e){return Mt[e]||(Mt[e]="&#"+e.charCodeAt(0)+";")}function X(e){var t,n,r=[];if(typeof e===Dt)for(t in e)n=e[t],t===Z||et(n)||r.push({key:t,prop:n});return r}function V(e,n,r){var i=this.jquery&&(this[0]||H('Unknown template: "'+this.selector+'"')),s=i.getAttribute(Pt);return _.call(s?t.data(i)[Ht]:nt(i),e,n,r)}function $(e){return void 0!=e?kt.test(e)&&(""+e).replace(At,W)||e:""}var J=t===!1;t=t&&t.fn?t:e.jQuery;var K,Q,G,Y,Z,et,tt,nt,rt,it,st,ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt,gt="v0.9.80",yt=/^(!*?)(?:null|true|false|\d[\d.]*|([\w$]+|\.|~([\w$]+)|#(view|([\w$]+))?)([\w$.^]*?)(?:[.[^]([\w$]+)\]?)?)$/g,bt=/(\()(?=\s*\()|(?:([([])\s*)?(?:(\^?)(!*?[#~]?[\w$.^]+)?\s*((\+\+|--)|\+|-|&&|\|\||===|!==|==|!=|<=|>=|[<>%*:?\/]|(=))\s*|(!*?[#~]?[\w$.^]+)([([])?)|(,\s*)|(\(?)\\?(?:(')|("))|(?:\s*(([)\]])(?=\s*[.^]|\s*$|[^([])|[)\]])([([]?))|(\s+)/g,wt=/[ \t]*(\r\n|\n|\r)/g,Et=/\\(['"])/g,St=/['"\\]/g,xt=/(?:\x08|^)(onerror:)?(?:(~?)(([\w$_\.]+):)?([^\x08]+))\x08(,)?([^\x08]+)/gi,Tt=/^if\s/,Nt=/<(\w+)[>\s]/,Ct=/[\x00`><"'&=]/g,kt=/[\x00`><\"'&=]/,Lt=/^on[A-Z]|^convert(Back)?$/,At=Ct,Ot=0,Mt={"&":"&amp;","<":"&lt;",">":"&gt;","\0":"&#0;","'":"&#39;",'"':"&#34;","`":"&#96;","=":"&#61;"},_t="html",Dt="object",Pt="data-jsv-tmpl",Ht="jsvTmpl",Bt="For #index in nested block use #getIndex().",jt={},Ft=e.jsrender,It=Ft&&t&&!t.render,qt={template:{compile:T},tag:{compile:S},viewModel:{compile:k},helper:{},converter:{}};if(Y={jsviews:gt,sub:{View:w,Err:a,tmplFn:j,parse:R,extend:f,extendCtx:z,syntaxErr:B,onStore:{},addSetting:O,settings:{allowCode:!1},advSet:o,_ths:i,_tg:function(){},_cnvt:m,_tag:b,_er:H,_err:P,_html:$,_cp:s,_sq:function(e){return"constructor"===e&&B(""),e}},settings:{delimiters:l,advanced:function(e){return e?(f(at,e),ot.advSet(),ft):at}},getCtx:s,map:M},(a.prototype=new Error).constructor=a,h.depends=function(){return[this.get("item"),"index"]},p.depends="index",w.prototype={get:c,getIndex:p,getRsc:y,getTmpl:v,hlp:d,_is:"view"},ot=Y.sub,ft=Y.settings,!(Ft||t&&t.render)){for(K in qt)A(K,qt[K]);rt=Y.converters,it=Y.helpers,st=Y.tags,ot._tg.prototype={baseApply:x,cvtArgs:g},G=ot.topView=new w,t?(t.fn.render=V,Z=t.expando,t.observable&&(f(ot,t.views.sub),Y.map=t.views.map)):(t={},J&&(e.jsrender=t),t.renderFile=t.__express=t.compile=function(){throw"Node.js: use npm jsrender, or jsrender-node.js"},t.isFunction=function(e){return"function"==typeof e},t.isArray=Array.isArray||function(e){return"[object Array]"==={}.toString.call(e)},ot._jq=function(e){e!==t&&(f(e,t),t=e,t.fn.render=V,delete t.jsrender,Z=t.expando)},t.jsrender=gt),ut=ot.settings,ut.allowCode=!1,et=t.isFunction,t.render=jt,t.views=Y,t.templates=nt=Y.templates;for(vt in ut)O(vt);(ft.debugMode=function(e){return void 0===e?ut.debugMode:(ut.debugMode=e,ut.onError=e+""===e?new Function("","return '"+e+"';"):et(e)?e:void 0,ft)})(!1),at=ut.advanced={useViews:!1,_jsv:!1},st({"if":{render:function(e){var t=this,n=t.tagCtx,r=t.rendering.done||!e&&(arguments.length||!n.index)?"":(t.rendering.done=!0,t.selected=n.index,n.render(n.view,!0));return r},flow:!0},"for":{render:function(e){var t,n=!arguments.length,r=this,i=r.tagCtx,s="",o=0;return r.rendering.done||(t=n?i.view.data:e,void 0!==t&&(s+=i.render(t,n),o+=tt(t)?t.length:1),(r.rendering.done=o)&&(r.selected=i.index)),s},flow:!0},props:{baseTag:"for",dataMap:M(X),flow:!0},include:{flow:!0},"*":{render:s,flow:!0},":*":{render:s,flow:!0},dbg:it.dbg=rt.dbg=u}),rt({html:$,attr:$,url:function(e){return void 0!=e?encodeURI(""+e):null===e?e:""}})}return ut=ot.settings,tt=t.isArray,ft.delimiters("{{","}}","^"),It&&Ft.views.sub._jq(t),t||Ft},window),n("app/simplelayout/Element",["app/simplelayout/idHelper","jsrender"],function(e){"use strict";function t(t,n){return this.template=$.templates(t),this.represents=n,this.enabled=!0,this.create=function(t){return this.element=$(this.template.render(t)),this.id=e.createGUID(),this.element.data({id:this.id,object:this}),this.element},this.data=function(e){return e?this.element.data(e):this.element.data()},this.remove=function(){return this.element.remove(),this},this.detach=function(){return this.element.detach(),this},this.attachToolbar=function(e){return this.toolbar=e,this.element.append(e.element),this},this.isEnabled=function(e){return this.element.toggleClass("disabled",!e),this.enabled=e,this},this.restore=function(e,t,n){this.element=$(e),this.parent=t,this.data({id:this.id,object:this,parent:t,represents:n}),this.represents=n},this}return t}),n("app/simplelayout/Block",["app/simplelayout/EventEmitter","app/simplelayout/transactional","app/simplelayout/Element"],function(e,t,n){"use strict";var r=function(t,i){if(!(this instanceof r))throw new TypeError("Block constructor cannot be called as a function.");this.name="block",this.type=i;var s=$($.templates('<div class="iFrameFix"></div>').render()),o='<div data-type="{{:type}}" class="sl-block {{:type}}"><div class="sl-block-content">{{:content}}</div></div>';n.call(this,o),this.create({type:i,content:t}),this.content=function(t){return $(".sl-block-content",this.element).html(t),e.trigger("blockReplaced",[this]),this},this.delete=function(){return this.parent.deleteBlock(this.id)},this.fixFrame=function(){return this.element.prepend(s),this},this.fixFrame(),this.enableFrame=function(){return s.css("display","block"),this},this.disableFrame=function(){return s.css("display","none"),this},this.restore=function(e,t,n,i){this.type=n,r.prototype.restore.call(this,e,t,i),this.fixFrame(),this.commit()},this.toJSON=function(){return{represents:this.represents,type:this.type}}};return t.call(r.prototype),n.call(r.prototype),r}),n("app/simplelayout/Toolbar",["app/simplelayout/Element"],function(e){"use strict";var t=function(n,r,i){if(!(this instanceof t))throw new TypeError("Toolbar constructor cannot be called as a function.");n=n||[];var s=$.templates("<ul class='sl-toolbar{{if type}}-{{:type}}{{/if}}{{if orientation}} {{:orientation}}{{/if}}'>{{for actions}}<li><a {{props}} {{>key}}='{{>prop}}' {{/props}}></a></li><li class='delimiter'></li>{{/for}}</ul>");e.call(this,s);var o=[];$.each(n,function(e,t){o.push(t)}),this.create({actions:o,orientation:r,type:i}),this.disable=function(e){$("."+e,this.element).css("display","none")},this.enable=function(e){$("."+e,this.element).css("display","inline")}};return e.call(t.prototype),t}),n("app/helpers/template_range",["jsrender"],function(){"use strict";$.views.tags({range:{baseTag:"for",render:function(e){var t=e,n=this.tagCtx.props.start||0,r=this.tagCtx.props.end;if(n||r)if(!this.tagCtx.args.length){t=[],r=r||0;for(var i=n;i<=r;i++)t.push(i)}else $.isArray(t)&&(t=t.slice(n,r));return this.base(t)},onArrayChange:function(){this.refresh()}}})}),n("app/simplelayout/Layout",["app/simplelayout/Block","app/simplelayout/EventEmitter","app/simplelayout/transactional","app/simplelayout/Element","app/simplelayout/Toolbar","app/helpers/template_range"],function(e,t,n,r,i){"use strict";var s=function(n){if(!(this instanceof s))throw new TypeError("Layout constructor cannot be called as a function.");n=n||4;var o="<div class='sl-layout'>{{range start=1 end=columns ~columns=columns}}<div class='sl-column sl-col-{{:~columns}}'></div>{{/range}}</div>";r.call(this,o),this.name="layout",this.create({columns:n}),this.columns=n,this.blocks={},this.toolbar=new i,this.hasBlocks=function(){return Object.keys(this.blocks).length>0},this.delete=function(){return this.parent.deleteLayout(this.id)},this.insertBlock=function(n,r){var i=new e(n,r);return i.parent=this,i.data({parent:this}),this.blocks[i.id]=i,t.trigger("blockInserted",[i]),i},this.deleteBlock=function(e){var n=this.blocks[e];return delete this.blocks[e],t.trigger("blockDeleted",[n]),n},this.getCommittedBlocks=function(){return $.grep($.map(this.blocks,function(e){return e}),function(e){return e.committed})},this.getInsertedBlocks=function(){return $.grep($.map(this.blocks,function(e){return e}),function(e){return!e.committed})},this.moveBlock=function(e,n){return t.trigger("beforeBlockMoved",[e]),this.deleteBlock(e.id),e.parent=n,e.data({parent:n}),n.blocks[e.id]=e,t.trigger("blockMoved",[e]),this},this.restore=function(e,t,n,r){var i=this;this.columns=n,s.prototype.restore.call(this,e,t,r),this.commit(),$(".sl-block",e).each(function(){i.insertBlock().restore(this,i,$(this).data().type,$(this).data().uid)})},this.toJSON=function(){return{columns:this.columns,blocks:this.blocks}}};return n.call(s.prototype),r.call(s.prototype),s}),n("app/simplelayout/Layoutmanager",["app/simplelayout/Layout","app/simplelayout/Block","app/simplelayout/EventEmitter","app/simplelayout/Element","app/simplelayout/transactional","app/helpers/template_range"],function(e,t,n,r,i){"use strict";var s=function(){if(!(this instanceof s))throw new TypeError("Layoutmanager constructor cannot be called as a function.");var t="<div class='sl-simplelayout'></div>";r.call(this,t),this.name="layoutmanager",this.create(),this.layouts={},this.attachTo=function(e){return $(e).append(this.element),this},this.insertLayout=function(t){var r=new e(t);return r.parent=this,r.data({parent:this}),this.layouts[r.id]=r,n.trigger("layoutInserted",[r]),r},this.deleteLayout=function(e){var t=this.layouts[e];return delete this.layouts[e],n.trigger("layoutDeleted",[t]),t},this.hasLayouts=function(){return Object.keys(this.layouts).length>0},this.getInsertedBlocks=function(){return $.map(this.layouts,function(e){return e.getInsertedBlocks()})},this.getCommittedBlocks=function(){return $.map(this.layouts,function(e){return e.getCommittedBlocks()})},this.moveBlock=function(e,t){return e.parent.moveBlock(e,t),this},this.restore=function(e,t){var n=this;s.prototype.restore.call(this,e,null,t),this.commit(),$(".sl-layout",e).each(function(){n.insertLayout().restore(this,n,$(".sl-column",this).length)})},this.toJSON=function(){return{layouts:this.layouts,represents:this.represents}}};return r.call(s.prototype),i.call(s.prototype),s}),function(e){e.path={};var t={rotate:function(e,t){var n=t*Math.PI/180,r=Math.cos(n),i=Math.sin(n);return[r*e[0]-i*e[1],i*e[0]+r*e[1]]},scale:function(e,t){return[t*e[0],t*e[1]]},add:function(e,t){return[e[0]+t[0],e[1]+t[1]]},minus:function(e,t){return[e[0]-t[0],e[1]-t[1]]}};e.path.bezier=function(n,r){n.start=e.extend({angle:0,length:.3333},n.start),n.end=e.extend({angle:0,length:.3333},n.end),this.p1=[n.start.x,n.start.y],this.p4=[n.end.x,n.end.y];var i=t.minus(this.p4,this.p1),s=t.scale(i,n.start.length),o=t.scale(i,-1),u=t.scale(o,n.end.length);s=t.rotate(s,n.start.angle),this.p2=t.add(this.p1,s),u=t.rotate(u,n.end.angle),this.p3=t.add(this.p4,u),this.f1=function(e){return e*e*e},this.f2=function(e){return 3*e*e*(1-e)},this.f3=function(e){return 3*e*(1-e)*(1-e)},this.f4=function(e){return(1-e)*(1-e)*(1-e)},this.css=function(e){var t=this.f1(e),n=this.f2(e),i=this.f3(e),s=this.f4(e),o={};return r&&(o.prevX=this.x,o.prevY=this.y),o.x=this.x=this.p1[0]*t+this.p2[0]*n+this.p3[0]*i+this.p4[0]*s+.5|0,o.y=this.y=this.p1[1]*t+this.p2[1]*n+this.p3[1]*i+this.p4[1]*s+.5|0,o.left=o.x+"px",o.top=o.y+"px",o}},e.path.arc=function(e,t){for(var n in e)this[n]=e[n];this.dir=this.dir||1;while(this.start>this.end&&this.dir>0)this.start-=360;while(this.start<this.end&&this.dir<0)this.start+=360;this.css=function(e){var n=(this.start*e+this.end*(1-e))*Math.PI/180,r={};return t&&(r.prevX=this.x,r.prevY=this.y),r.x=this.x=Math.sin(n)*this.radius+this.center[0]+.5|0,r.y=this.y=Math.cos(n)*this.radius+this.center[1]+.5|0,r.left=r.x+"px",r.top=r.y+"px",r}},e.fx.step.path=function(t){var n=t.end.css(1-t.pos);n.prevX!=null&&e.cssHooks.transform.set(t.elem,"rotate("+Math.atan2(n.prevY-n.y,n.prevX-n.x)+")"),t.elem.style.top=n.top,t.elem.style.left=n.left}}(jQuery),n("jquery-path",function(e){return function(){var t,n;return t||e.jQuery.path}}(this)),n("app/toolbox/Toolbox",["app/simplelayout/Element","jsrender","jquery-path"],function(e){"use strict";var t=function(n){if(!(this instanceof t))throw new TypeError("Toolbox constructor cannot be called as a function.");var r=$.templates("<div id='sl-toolbox' class='sl-toolbox'>       <div>         <a class='sl-toolbox-header blocks'>           <span></span>         </a>           <div class='sl-toolbox-blocks'>             {{for blocks}}               <a class='sl-toolbox-block {{:contentType}}' data-type='{{:contentType}}' data-form-url='{{:formUrl}}'>                 <span class='icon-{{:contentType}}'></span>                 <span class='description'>{{:title}}</span>               </a>             {{/for}}           </div>           {{if canChangeLayout}}             <a class='sl-toolbox-header layouts'>               <span></span>             </a>             <div class='sl-toolbox-layouts'>               {{props layouts}}                 <a class='sl-toolbox-layout' data-columns='{{>prop}}'>                   <span>{{>prop}}</span>                   <span class='description'>{{>prop}}{{>#parent.parent.data.labels.labelColumnPostfix}}</span>                 </a>               {{/props}}             </div>           {{/if}}         </div>       </div>");e.call(this,r),this.options=$.extend({layouts:[1,2,4],blocks:[],labels:{},layoutActions:{}},n||{}),this.create({blocks:this.options.blocks,layouts:this.options.layouts,labels:this.options.labels,canChangeLayout:this.options.canChangeLayout});var i={};$.each(this.options.blocks,function(e,t){i[t.contentType]=t}),this.options.blocks=i,this.attachTo=function(e){e.append(this.element)},this.blocksEnabled=function(e){$(".sl-toolbox-blocks",this.element).toggleClass("disabled",!e)};var s=$.ui.draggable.prototype._mouseStart;$.ui.draggable.prototype._mouseStart=function(e,t,n){this._trigger("beforeStart",e,this._uiHash()),s.apply(this,[e,t,n])},this.triggerHint=function(e,t,n){n=$.extend({time:500,easing:"easeInOutQuad"},n);var r={start:{x:0,y:e.position().top,angle:70},end:{x:-$(window).width()/2+e.width(),y:$(window).height()/2-e.height(),angle:290}},i=new $.path.bezier(r),s=e.clone().insertAfter(e);s.css("position","absolute").css("z-index","1"),s.animate({path:i},n.time,n.easing,function(){s.css("z-index","auto").addClass("hintDropped")}),setTimeout(function(){s.remove()},n.time+300)}};return e.call(t.prototype),t}),n("app/simplelayout/Simplelayout",["app/simplelayout/Layoutmanager","app/simplelayout/Toolbar","app/toolbox/Toolbox","app/simplelayout/EventEmitter"],function(e,t,n,r){"use strict";var i=function(s){if(!(this instanceof i))throw new TypeError("Simplelayout constructor cannot be called as a function.");var o=$(":root"),u=this,a=function(){return $('<div class="draggableHelper"><div>')},f={connectWith:".sl-simplelayout",items:".sl-layout",handle:".sl-toolbar-layout .move",placeholder:"layout-placeholder",cursorAt:{left:50,top:50},forcePlaceholderSize:!0,helper:a,receive:function(e,t){var n;if(t.item.hasClass("sl-toolbox-layout")){var r=$(this).find(".ui-draggable");n=$(this).data().object.insertLayout(t.item.data().columns),n.element.insertAfter(r),r.remove()}else u.moveLayout($(t.item).data().object,$(this).data().object),u.disableFrames()},beforeStart:function(e,t){t.item.hasClass("sl-layout")&&u.restrictLayout(t.item.data().object.columns)},start:function(){u.enableFrames(),o.addClass("sl-layout-dragging"),$(".sl-simplelayout").sortable("refreshPositions")},update:function(e,t){t.item.parent()[0]===this&&!t.sender&&r.trigger("layoutMoved",[t.item.data().object])},stop:function(e,t){t.item.hasClass("sl-layout")&&u.allowLayout(t.item.data().object.columns),o.removeClass("sl-layout-dragging"),u.disableFrames()}},l={connectWith:".sl-column",placeholder:"block-placeholder",forcePlaceholderSize:!0,handle:".sl-toolbar-block .move",helper:a,cursorAt:{left:50,top:50},receive:function(e,t){var n;if($(t.item).hasClass("sl-toolbox-block")){var r=$(this).find(".ui-draggable"),i=$(this).parents(".sl-layout").data().object;n=i.insertBlock("",$(t.item).data().type),n.element.insertAfter(r),r.remove()}else{var s=t.sender.parents(".sl-layout").data().object;s.moveBlock(t.item.data().object,$(this).parents(".sl-layout").data().object)}},start:function(){u.enableFrames(),o.addClass("sl-block-dragging"),$(".sl-column").sortable("refreshPositions")},stop:function(){u.disableFrames(),o.removeClass("sl-block-dragging")},update:function(e,t){t.item.parent()[0]===this&&!t.sender&&r.trigger("blockMoved",[t.item.data().object])}};this.options=$.extend({toolbox:new n,editLayouts:!0,layoutRestrictions:{}},s||{}),this.managers={},this.insertManager=function(){var t=new e;return this.managers[t.id]=t,t},this.moveLayout=function(e,t){var n=e.parent;return e.data({parent:t}),e.parent=t,t.layouts[e.id]=e,n.deleteLayout(e.id),r.trigger("layoutMoved",[e]),this},this.getCommittedBlocks=function(){return $.map(this.managers,function(e){return e.getCommittedBlocks()})},this.getInsertedBlocks=function(){return $.map(this.managers,function(e){return e.getInsertedBlocks()})},this.disableFrames=function(){return $.each(this.getCommittedBlocks(),function(e,t){t.disableFrame()}),this},this.enableFrames=function(){return $.each(this.getCommittedBlocks(),function(e,t){t.enableFrame()}),this},this.restrictLayout=function(e){this.options.layoutRestrictions[e]&&$.each(this.options.layoutRestrictions[e],function(e,t){u.managers[t].isEnabled(!1).element.sortable("disable")})},this.allowLayout=function(e){this.options.layoutRestrictions[e]&&$.each(this.options.layoutRestrictions[e],function(e,t){u.managers[t].isEnabled(!0).element.sortable("enable")})},this.on=function(e,t){return r.on(e,t),this},this.serialize=function(){return JSON.stringify(this.managers)},this.restore=function(e){return this.source=e,$(".sl-simplelayout",e).each(function(){u.insertManager().restore(this,$(this).attr("id"))}),$(".sl-simplelayout",this.source).sortable(f),$(".sl-column",this.source).sortable(l),this};var c={helper:"clone",cursor:"pointer",beforeStart:function(){$(this).hasClass("sl-toolbox-layout")&&u.restrictLayout($(this).data().columns)},start:function(){u.enableFrames(),$(this).hasClass("sl-toolbox-block")?o.addClass("sl-block-dragging"):o.addClass("sl-layout-dragging")},stop:function(){u.allowLayout($(this).data().columns),u.disableFrames(),o.removeClass("sl-block-dragging sl-layout-dragging")}};this.on("layout-committed",function(e){if(u.options.editLayouts){var n=new t(u.options.toolbox.options.layoutActions,"vertical","layout");e.attachToolbar(n),$(".sl-column",e.element).sortable(l)}}),this.on("block-committed",function(e){if(u.options.toolbox.options.blocks[e.type]){var n=new t(u.options.toolbox.options.blocks[e.type].actions,"horizontal","block");e.attachToolbar(n)}}),this.options.toolbox.element.find(".sl-toolbox-block, .sl-toolbox-layout").draggable(c),this.options.toolbox.element.find(".sl-toolbox-layout").draggable("option","connectToSortable",".sl-simplelayout"),this.options.toolbox.element.find(".sl-toolbox-block").draggable("option","connectToSortable",".sl-column"),$(".sl-simplelayout").sortable(f),$(".sl-column").sortable(l),o.addClass("simplelayout-initialized");var h=$.ui.sortable.prototype._mouseStart;$.ui.sortable.prototype._mouseStart=function(e,t,n){this._trigger("beforeStart",e,this._uiHash()),h.apply(this,[e,t,n])}};return i}),t.config({baseUrl:"js/lib/",paths:{app:"../app",EventEmitter:"eventEmitter/EventEmitter.min",jquery:"jquery/dist/jquery",jqueryui:"jquery-ui/ui/minified/jquery-ui.custom.min",jsrender:"jsrender/jsrender.min","jquery-path":"jquery-path/jquery.path"},shim:{jsrender:{deps:["jquery"],exports:"jQuery.fn.template"},jqueryui:{deps:["jquery"]},"jquery-path":{exports:"jQuery.path"}}}),n("app",["app/simplelayout/Simplelayout","app/toolbox/Toolbox","app/simplelayout/EventEmitter","jsrender"],function(e,t){"use strict";return{simplelayout:e,toolbox:t}}),t("app")});